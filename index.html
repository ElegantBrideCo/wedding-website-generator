<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Wedding Website Generator ‚Äî Elegant Bride Co.</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Jost:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400&family=Raleway:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --sage: #A8B89C; --sage-dark: #8FA98F;
            --blush: #D4A5A5; --blush-light: #F0E0E0;
            --cream: #F8F6F3; --warm-gray: #E8E4DF;
            --text: #4A4540; --text-light: #8A837C; --border: #D8D0C8;
        }
        body { font-family: 'Jost', sans-serif; background: var(--cream); color: var(--text); min-height: 100vh; }

        /* ‚îÄ‚îÄ SITE HEADER ‚îÄ‚îÄ */
        .site-header { background: white; border-bottom: 1px solid var(--border); padding: 0 32px; display: flex; align-items: center; justify-content: space-between; height: 60px; position: sticky; top: 0; z-index: 200; }
        .site-header .brand { font-family: 'Cormorant Garamond', serif; font-size: 1.3rem; color: var(--blush); letter-spacing: 0.05em; text-decoration: none; }
        .header-right { display: flex; align-items: center; gap: 14px; }
        .user-pill { display: flex; align-items: center; gap: 8px; background: var(--cream); border: 1px solid var(--border); border-radius: 20px; padding: 6px 14px; font-size: 0.8rem; color: var(--text-light); }
        .user-pill strong { color: var(--text); font-weight: 500; }
        .btn-signout { background: none; border: none; color: var(--text-light); font-size: 0.78rem; cursor: pointer; text-decoration: underline; font-family: 'Jost', sans-serif; }
        .btn-signout:hover { color: var(--blush); }

        /* ‚îÄ‚îÄ AUTH SCREEN ‚îÄ‚îÄ */
        #authScreen { min-height: calc(100vh - 60px); display: flex; align-items: center; justify-content: center; padding: 40px 20px; }
        .auth-card { background: white; border-radius: 20px; border: 1px solid var(--border); padding: 48px 44px; width: 100%; max-width: 440px; box-shadow: 0 8px 40px rgba(0,0,0,0.06); }
        .auth-card h2 { font-family: 'Cormorant Garamond', serif; font-size: 2rem; font-weight: 300; color: var(--text); margin-bottom: 6px; }
        .auth-card p { color: var(--text-light); font-size: 0.88rem; line-height: 1.6; margin-bottom: 28px; }
        .auth-tabs { display: flex; border-bottom: 2px solid var(--border); margin-bottom: 28px; }
        .auth-tab { flex: 1; padding: 10px; text-align: center; font-size: 0.85rem; font-weight: 500; color: var(--text-light); cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.2s; }
        .auth-tab.active { color: var(--blush); border-bottom-color: var(--blush); }
        .auth-field { margin-bottom: 16px; }
        .auth-field label { display: block; font-size: 0.8rem; font-weight: 500; color: var(--text); margin-bottom: 6px; }
        .auth-field input { width: 100%; border: 1.5px solid var(--border); border-radius: 10px; padding: 11px 14px; font-family: 'Jost', sans-serif; font-size: 0.95rem; color: var(--text); transition: border-color 0.2s; }
        .auth-field input:focus { outline: none; border-color: var(--blush); }
        .btn-auth { width: 100%; background: var(--blush); color: white; border: none; padding: 13px; border-radius: 50px; font-family: 'Jost', sans-serif; font-size: 0.95rem; font-weight: 500; cursor: pointer; transition: all 0.2s; margin-top: 8px; }
        .btn-auth:hover { background: #C49090; }
        .btn-auth:disabled { opacity: 0.6; cursor: not-allowed; }
        .auth-error { color: #c0392b; font-size: 0.82rem; margin-top: 10px; display: none; }
        .auth-divider { display: flex; align-items: center; gap: 12px; margin: 20px 0; color: var(--text-light); font-size: 0.8rem; }
        .auth-divider::before, .auth-divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }
        .btn-google { width: 100%; background: white; color: var(--text); border: 1.5px solid var(--border); padding: 12px; border-radius: 50px; font-family: 'Jost', sans-serif; font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-google:hover { border-color: var(--blush); background: var(--cream); }

        /* ‚îÄ‚îÄ MAIN EDITOR LAYOUT ‚îÄ‚îÄ */
        #appScreen { display: none; height: calc(100vh - 60px); }
        #appScreen.visible { display: flex; flex-direction: column; }
        .app-toolbar { background: white; border-bottom: 1px solid var(--border); padding: 0 24px; display: flex; align-items: center; justify-content: space-between; height: 52px; flex-shrink: 0; gap: 12px; }
        .toolbar-left { display: flex; align-items: center; gap: 10px; }
        .toolbar-center { display: flex; gap: 6px; }
        .toolbar-right { display: flex; align-items: center; gap: 10px; }
        .preview-toggle { display: flex; border: 1.5px solid var(--border); border-radius: 20px; overflow: hidden; }
        .preview-toggle button { padding: 5px 14px; background: white; border: none; font-size: 0.78rem; font-weight: 500; cursor: pointer; color: var(--text-light); font-family: 'Jost', sans-serif; transition: all 0.15s; }
        .preview-toggle button.active { background: var(--blush); color: white; }
        .btn-generate-sm { background: var(--sage); color: white; border: none; padding: 8px 20px; border-radius: 20px; font-family: 'Jost', sans-serif; font-size: 0.82rem; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
        .btn-generate-sm:hover { background: var(--sage-dark); }
        .btn-publish { background: var(--blush); color: white; border: none; padding: 8px 22px; border-radius: 20px; font-family: 'Jost', sans-serif; font-size: 0.82rem; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
        .btn-publish:hover { background: #C49090; }
        .btn-publish:disabled { opacity: 0.6; cursor: not-allowed; }
        .published-chip { background: #e8f5e9; color: #2e7d32; border: 1px solid #a5d6a7; border-radius: 20px; padding: 5px 12px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 6px; text-decoration: none; }

        /* ‚îÄ‚îÄ TWO-PANEL EDITOR ‚îÄ‚îÄ */
        .editor-panels { display: flex; flex: 1; overflow: hidden; }
        /* Narrow icon nav strip */
        .icon-nav { width: 72px; flex-shrink: 0; background: white; border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 8px 0; overflow-y: auto; }
        .icon-nav-item { display: flex; flex-direction: column; align-items: center; gap: 3px; padding: 10px 4px; width: 100%; cursor: pointer; border-left: 3px solid transparent; transition: all 0.15s; text-align: center; }
        .icon-nav-item:hover { background: var(--cream); }
        .icon-nav-item.active { background: var(--cream); border-left-color: var(--blush); }
        .icon-nav-item .nav-icon { font-size: 1.3rem; line-height: 1; }
        .icon-nav-item .nav-label { font-size: 0.58rem; font-weight: 500; color: var(--text-light); line-height: 1.2; }
        .icon-nav-item.active .nav-label { color: var(--blush); }
        /* Edit panel column */
        .left-panel { width: 340px; flex-shrink: 0; background: white; border-right: 1px solid var(--border); overflow-y: auto; display: flex; flex-direction: column; }
        .left-panel-header { padding: 14px 18px 10px; border-bottom: 1px solid var(--border); font-size: 0.7rem; font-weight: 600; letter-spacing: 0.14em; text-transform: uppercase; color: var(--text-light); flex-shrink: 0; }
        /* Edit panels */
        .edit-panels { flex: 1; overflow-y: auto; }
        .edit-panel { display: none; padding: 18px; }
        .edit-panel.active { display: block; }
        .edit-panel h3 { font-family: 'Cormorant Garamond', serif; font-size: 1.2rem; font-weight: 400; color: var(--text); margin-bottom: 16px; padding-bottom: 10px; border-bottom: 1px solid var(--warm-gray); }
        .ep-field { margin-bottom: 14px; }
        .ep-field label { display: block; font-size: 0.78rem; font-weight: 500; color: var(--text); margin-bottom: 5px; }
        .ep-field input, .ep-field textarea, .ep-field select { width: 100%; border: 1.5px solid var(--border); border-radius: 8px; padding: 9px 12px; font-family: 'Jost', sans-serif; font-size: 0.88rem; color: var(--text); background: white; transition: border-color 0.2s; }
        .ep-field input:focus, .ep-field textarea:focus, .ep-field select:focus { outline: none; border-color: var(--blush); }
        .ep-field textarea { resize: vertical; min-height: 80px; line-height: 1.6; }
        .ep-field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 14px; }
        .ep-hint { font-size: 0.72rem; color: var(--text-light); margin-top: 4px; line-height: 1.4; }
        .ep-section-divider { border: none; border-top: 1px solid var(--warm-gray); margin: 16px 0; }
        .ep-add-btn { display: flex; align-items: center; justify-content: center; gap: 6px; width: 100%; padding: 9px; background: var(--cream); border: 1.5px dashed var(--border); border-radius: 8px; color: var(--blush); font-family: 'Jost', sans-serif; font-size: 0.82rem; font-weight: 500; cursor: pointer; transition: all 0.2s; margin-top: 8px; }
        .ep-add-btn:hover { border-color: var(--blush); background: white; }
        .ep-item { background: var(--cream); border-radius: 8px; padding: 12px; margin-bottom: 10px; position: relative; }
        .ep-item-remove { position: absolute; top: 8px; right: 8px; background: none; border: none; color: var(--text-light); cursor: pointer; font-size: 1rem; line-height: 1; padding: 2px 5px; border-radius: 4px; }
        .ep-item-remove:hover { background: var(--blush-light); color: var(--blush); }

        /* Photo upload in panel */
        .ep-photo-upload { border: 2px dashed var(--border); border-radius: 10px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.2s; background: var(--cream); position: relative; }
        .ep-photo-upload:hover { border-color: var(--blush); background: white; }
        .ep-photo-upload input { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }
        .ep-photo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
        .ep-photo-thumb { position: relative; aspect-ratio: 1; border-radius: 6px; overflow: hidden; }
        .ep-photo-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .ep-photo-thumb button { position: absolute; top: 3px; right: 3px; background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%; width: 18px; height: 18px; font-size: 0.65rem; cursor: pointer; }

        /* Tone picker in panel */
        .ep-tone-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .ep-tone-opt { display: none; }
        .ep-tone-label { display: flex; align-items: center; gap: 8px; padding: 10px 12px; border: 1.5px solid var(--border); border-radius: 8px; cursor: pointer; transition: all 0.15s; background: var(--cream); font-size: 0.82rem; }
        .ep-tone-label:hover { border-color: var(--blush); background: white; }
        .ep-tone-opt:checked + .ep-tone-label { border-color: var(--blush); background: white; box-shadow: 0 0 0 2px var(--blush-light); font-weight: 500; }

        /* Theme picker in panel */
        .ep-theme-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .ep-theme-opt { display: none; }
        .ep-theme-label { border: 1.5px solid var(--border); border-radius: 8px; overflow: hidden; cursor: pointer; transition: all 0.15s; }
        .ep-theme-label:hover { border-color: var(--blush); }
        .ep-theme-label:has(.ep-theme-opt:checked) { border-color: var(--blush); box-shadow: 0 0 0 2px var(--blush-light); }
        .ep-theme-swatch { height: 40px; display: flex; }
        .ep-theme-swatch span { flex: 1; }
        .ep-theme-name { padding: 6px 8px; background: white; font-size: 0.72rem; font-weight: 600; color: var(--text); }

        /* Story panel */
        .story-ai-note { background: linear-gradient(135deg, #f9f5ff, #fff5f5); border: 1px solid var(--blush-light); border-radius: 8px; padding: 12px 14px; font-size: 0.78rem; color: var(--text-light); line-height: 1.5; margin-bottom: 14px; }
        .story-ai-note strong { color: var(--blush); }
        #storyEditor { border: 1.5px solid var(--border); border-radius: 8px; padding: 12px; min-height: 200px; font-size: 0.88rem; line-height: 1.8; color: var(--text); outline: none; }
        #storyEditor:focus { border-color: var(--blush); }
        .btn-apply { background: var(--sage); color: white; border: none; padding: 8px 18px; border-radius: 20px; font-family: 'Jost', sans-serif; font-size: 0.8rem; font-weight: 500; cursor: pointer; margin-top: 10px; }

        /* Right panel */
        .right-panel { flex: 1; background: #E8E4DF; display: flex; flex-direction: column; overflow: hidden; }
        .preview-bar { background: white; border-bottom: 1px solid var(--border); padding: 8px 16px; display: flex; align-items: center; gap: 8px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
        .dot-r { background: #FF6058; } .dot-y { background: #FFBD2E; } .dot-g { background: #28C840; }
        .url-bar { flex: 1; background: var(--cream); border-radius: 20px; padding: 4px 14px; font-size: 0.75rem; color: var(--text-light); }
        .preview-wrap { flex: 1; display: flex; justify-content: center; align-items: flex-start; overflow: auto; padding: 0; transition: all 0.3s; position: relative; }
        .preview-wrap.mobile { padding: 20px; }
        #previewFrame { width: 100%; height: 100%; border: none; flex-shrink: 0; transition: all 0.3s; }
        .preview-wrap.mobile #previewFrame { width: 390px; height: 844px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }

        /* Loading overlay */
        #generatingOverlay { display: none; position: fixed; inset: 0; background: rgba(248,246,243,0.95); z-index: 500; align-items: center; justify-content: center; flex-direction: column; gap: 16px; }
        #generatingOverlay.visible { display: flex; }
        .gen-rings { display: flex; gap: 6px; }
        .gen-ring { width: 12px; height: 12px; border-radius: 50%; background: var(--blush); animation: pulse 1.4s ease-in-out infinite; }
        .gen-ring:nth-child(2) { animation-delay: 0.2s; background: var(--sage); }
        .gen-ring:nth-child(3) { animation-delay: 0.4s; }
        @keyframes pulse { 0%,80%,100%{transform:scale(0.6);opacity:0.4;}40%{transform:scale(1);opacity:1;} }
        .gen-title { font-family: 'Cormorant Garamond', serif; font-size: 1.6rem; color: var(--text); }
        .gen-sub { color: var(--text-light); font-size: 0.9rem; }

        /* Published banner in left panel */
        .published-banner { background: linear-gradient(135deg, #A8B89C, #8FA98F); color: white; border-radius: 10px; padding: 14px 16px; margin: 14px; font-size: 0.8rem; }
        .published-banner a { color: white; font-weight: 600; word-break: break-all; display: block; margin: 6px 0; }
        .published-banner-btns { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
        .published-banner-btn { background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.4); padding: 5px 12px; border-radius: 20px; cursor: pointer; font-size: 0.75rem; font-family: 'Jost', sans-serif; }

        /* Toast */
        #toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(20px); background: #4A4540; color: white; padding: 10px 22px; border-radius: 20px; font-size: 0.85rem; opacity: 0; transition: all 0.3s; z-index: 9999; pointer-events: none; white-space: nowrap; }
        #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* Steps indicator */
        .steps-mini { display: flex; align-items: center; gap: 6px; font-size: 0.72rem; }
        .step-dot { width: 20px; height: 20px; border-radius: 50%; border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 600; color: var(--text-light); flex-shrink: 0; }
        .step-dot.done { background: var(--sage); border-color: var(--sage); color: white; }
        .step-dot.active { background: var(--blush); border-color: var(--blush); color: white; }
        .step-line-mini { width: 20px; height: 1px; background: var(--border); }

        @media (max-width: 768px) {
            .left-panel { width: 280px; }
        }
    </style>
</head>
<body>

<!-- SITE HEADER -->
<header class="site-header">
    <a href="https://www.elegantbrideco.com" class="brand">Elegant Bride Co.</a>
    <div class="header-right">
        <div id="userPill" class="user-pill" style="display:none;">
            Logged in as <strong id="userEmail">‚Äî</strong>
        </div>
        <button class="btn-signout" id="signOutBtn" style="display:none;" onclick="signOut()">Sign out</button>
    </div>
</header>

<!-- AUTH SCREEN -->
<div id="authScreen">
    <div class="auth-card">
        <h2>Your Free Wedding Website</h2>
        <p>Create a beautiful, personalized wedding website in minutes ‚Äî free forever. Sign in to save your site and edit it from any device.</p>
        <div class="auth-tabs">
            <div class="auth-tab active" id="loginTab" onclick="switchAuthTab('login')">Sign In</div>
            <div class="auth-tab" id="signupTab" onclick="switchAuthTab('signup')">Create Account</div>
        </div>
        <div id="loginForm">
            <div class="auth-field"><label>Email address</label><input type="email" id="loginEmail" placeholder="you@email.com"></div>
            <div class="auth-field"><label>Password</label><input type="password" id="loginPassword" placeholder="Your password"></div>
            <button class="btn-auth" onclick="handleLogin()" id="loginBtn">Sign In</button>
            <div class="auth-error" id="loginError"></div>
        </div>
        <div id="signupForm" style="display:none;">
            <div class="auth-field"><label>Email address</label><input type="email" id="signupEmail" placeholder="you@email.com"></div>
            <div class="auth-field"><label>Create a password</label><input type="password" id="signupPassword" placeholder="At least 6 characters"></div>
            <div class="auth-field"><label>Confirm password</label><input type="password" id="signupPassword2" placeholder="Repeat your password"></div>
            <button class="btn-auth" onclick="handleSignup()" id="signupBtn">Create Account</button>
            <div class="auth-error" id="signupError"></div>
        </div>
        <div class="auth-divider">or</div>
        <button class="btn-google" onclick="handleGoogleSignIn()">
            <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
            Continue with Google
        </button>
    </div>
</div>

<!-- APP SCREEN (two-panel editor) -->
<div id="appScreen">

    <!-- TOOLBAR -->
    <div class="app-toolbar">
        <div class="toolbar-left">
            <div class="steps-mini">
                <div class="step-dot active" id="sd1">1</div>
                <div class="step-line-mini"></div>
                <div class="step-dot" id="sd2">2</div>
                <div class="step-line-mini"></div>
                <div class="step-dot" id="sd3">3</div>
            </div>
            <span style="font-size:0.75rem;color:var(--text-light);margin-left:4px;" id="toolbarStatus">Fill in your details, then generate</span>
        </div>
        <div class="toolbar-center">
            <div class="preview-toggle">
                <button class="active" id="deskBtn" onclick="setPreviewMode('desktop')">üñ• Desktop</button>
                <button id="mobileBtn" onclick="setPreviewMode('mobile')">üì± Mobile</button>
            </div>
        </div>
        <div class="toolbar-right">
            <button class="btn-generate-sm" onclick="generateWebsite()" id="generateBtn">‚ú¶ Generate Website</button>
            <button class="btn-publish" onclick="publishWebsite()" id="publishBtn" style="display:none;">üåê Publish</button>
            <a id="publishedChip" class="published-chip" href="#" target="_blank" style="display:none;">‚úì Live</a>
        </div>
    </div>

    <!-- PANELS -->
    <div class="editor-panels">

        <!-- ICON NAV (narrow strip like Zola) -->
        <div class="icon-nav">
            <div class="icon-nav-item active" onclick="showSection('names')" id="nav-names"><span class="nav-icon">üíë</span><span class="nav-label">Names</span></div>
            <div class="icon-nav-item" onclick="showSection('photo')" id="nav-photo"><span class="nav-icon">üì∑</span><span class="nav-label">Photo</span></div>
            <div class="icon-nav-item" onclick="showSection('story')" id="nav-story"><span class="nav-icon">‚ú®</span><span class="nav-label">Story</span></div>
            <div class="icon-nav-item" onclick="showSection('details')" id="nav-details"><span class="nav-icon">üìç</span><span class="nav-label">Details</span></div>
            <div class="icon-nav-item" onclick="showSection('schedule')" id="nav-schedule"><span class="nav-icon">üïê</span><span class="nav-label">Schedule</span></div>
            <div class="icon-nav-item" onclick="showSection('party')" id="nav-party"><span class="nav-icon">ü•Ç</span><span class="nav-label">Party</span></div>
            <div class="icon-nav-item" onclick="showSection('gallery')" id="nav-gallery"><span class="nav-icon">üñº</span><span class="nav-label">Gallery</span></div>
            <div class="icon-nav-item" onclick="showSection('hotels')" id="nav-hotels"><span class="nav-icon">üè®</span><span class="nav-label">Hotels</span></div>
            <div class="icon-nav-item" onclick="showSection('registry')" id="nav-registry"><span class="nav-icon">üéÅ</span><span class="nav-label">Registry</span></div>
            <div class="icon-nav-item" onclick="showSection('theme')" id="nav-theme"><span class="nav-icon">üé®</span><span class="nav-label">Theme</span></div>
            <div class="icon-nav-item" onclick="showSection('resources')" id="nav-resources"><span class="nav-icon">üõçÔ∏è</span><span class="nav-label">Shops</span></div>
        </div>
        <!-- LEFT PANEL (edit fields) -->
        <div class="left-panel">
            <div class="left-panel-header" id="leftPanelHeader">Names & Date</div>
            <!-- Published banner -->
            <div id="publishedBanner" class="published-banner" style="display:none;">
                üéâ Your site is live!
                <a id="publishedUrl" href="#" target="_blank"></a>
                <div class="published-banner-btns">
                    <button class="published-banner-btn" onclick="copyPublishedUrl()">üìã Copy Link</button>
                    <button class="published-banner-btn" onclick="publishWebsite()">üîÑ Update Site</button>
                </div>
            </div>
            <!-- Edit panels -->
            <div class="edit-panels">

                <!-- NAMES & DATE -->
                <div class="edit-panel active" id="panel-names">
                    <h3>Names & Date</h3>
                    <div class="ep-field-row">
                        <div class="ep-field"><label>Your Name</label><input type="text" id="name1" placeholder="e.g. Sarah" oninput="liveUpdate()"></div>
                        <div class="ep-field"><label>Partner's Name</label><input type="text" id="name2" placeholder="e.g. James" oninput="liveUpdate()"></div>
                    </div>
                    <div class="ep-field"><label>Wedding Date</label><input type="date" id="weddingDate" onchange="liveUpdate()"></div>
                </div>

                <!-- COUPLE PHOTO -->
                <div class="edit-panel" id="panel-photo">
                    <h3>Couple Photo</h3>
                    <p class="ep-hint" style="margin-bottom:14px;">This appears as a full-width banner at the top of your website. Landscape photos work best.</p>
                    <div class="ep-photo-upload" onclick="document.getElementById('heroPhotoInput').click()">
                        <input type="file" id="heroPhotoInput" accept="image/*" style="display:none" onchange="handleHeroPhoto(event)">
                        <div id="heroPreviewPanel" style="font-size:1.8rem;margin-bottom:6px;">üì∑</div>
                        <div style="font-size:0.82rem;color:var(--text-light);">Click to upload photo</div>
                        <div style="font-size:0.72rem;color:var(--border);margin-top:4px;">Landscape ¬∑ JPG or PNG</div>
                    </div>
                    <button id="heroRemoveBtn" style="display:none;margin-top:10px;background:none;border:none;color:var(--text-light);font-size:0.78rem;cursor:pointer;text-decoration:underline;font-family:'Jost',sans-serif;" onclick="removeHeroPhoto()">‚úï Remove photo</button>
                </div>

                <!-- YOUR STORY -->
                <div class="edit-panel" id="panel-story">
                    <h3>Your Story</h3>
                    <div class="story-ai-note">
                        <strong>‚ú¶ AI-written for you.</strong> Fill in your details and click Generate ‚Äî we'll write your story. You can edit the text below anytime.
                    </div>
                    <div class="ep-field">
                        <label>Writing Tone</label>
                        <div class="ep-tone-grid" style="margin-top:6px;">
                            <input type="radio" name="tone" value="romantic" id="tone-romantic" class="ep-tone-opt" checked>
                            <label for="tone-romantic" class="ep-tone-label">üíï Romantic</label>
                            <input type="radio" name="tone" value="humorous" id="tone-humorous" class="ep-tone-opt">
                            <label for="tone-humorous" class="ep-tone-label">üòÑ Humorous</label>
                            <input type="radio" name="tone" value="modern" id="tone-modern" class="ep-tone-opt">
                            <label for="tone-modern" class="ep-tone-label">‚ú® Modern</label>
                            <input type="radio" name="tone" value="whimsical" id="tone-whimsical" class="ep-tone-opt">
                            <label for="tone-whimsical" class="ep-tone-label">üåô Whimsical</label>
                            <input type="radio" name="tone" value="classic" id="tone-classic" class="ep-tone-opt">
                            <label for="tone-classic" class="ep-tone-label">üìú Classic</label>
                            <input type="radio" name="tone" value="roast" id="tone-roast" class="ep-tone-opt">
                            <label for="tone-roast" class="ep-tone-label">üî• Roast</label>
                        </div>
                        <p class="ep-hint" style="margin-top:6px;">Affects how your AI-written story sounds.</p>
                    </div>
                    <div class="ep-field"><label>How did you meet?</label><textarea id="howMet" placeholder="Tell us how your story began..." oninput="autoSave()"></textarea></div>
                    <div class="ep-field"><label>The proposal <span style="font-weight:300;color:var(--text-light);">(optional)</span></label><textarea id="proposal" placeholder="How did it happen?" oninput="autoSave()"></textarea></div>
                    <div class="ep-field"><label>Anything else to share? <span style="font-weight:300;color:var(--text-light);">(optional)</span></label><textarea id="extraDetails" placeholder="Funny moments, meaningful details..." oninput="autoSave()"></textarea></div>
                    <hr class="ep-section-divider">
                    <div style="font-size:0.78rem;font-weight:500;color:var(--text);margin-bottom:8px;">Story text (edit after generating)</div>
                    <div id="storyEditor" contenteditable="false" style="border:1.5px solid var(--border);border-radius:8px;padding:12px;min-height:120px;font-size:0.85rem;line-height:1.8;color:var(--text);outline:none;background:var(--cream);color:var(--text-light);" placeholder="Generate your website first to see your story here.">Generate your website first to see your story here.</div>
                    <button class="btn-apply" onclick="applyStoryEdit()" id="applyStoryBtn" style="display:none;">Apply Changes ‚Üí</button>
                </div>

                <!-- WEDDING DETAILS -->
                <div class="edit-panel" id="panel-details">
                    <h3>Wedding Details</h3>
                    <div class="ep-field"><label>Ceremony Venue</label><input type="text" id="ceremonyLocation" placeholder="e.g. Riverside Gardens, Austin TX" oninput="liveUpdate()"></div>
                    <div class="ep-field"><label>Ceremony Time</label><input type="time" id="ceremonyTime" onchange="liveUpdate()"></div>
                    <div class="ep-field"><label>Ceremony Address <span style="font-weight:300;color:var(--text-light);">(for map)</span></label><input type="text" id="ceremonyAddress" placeholder="e.g. 123 River Rd, Austin TX" oninput="liveUpdate()"></div>
                    <div class="ep-field"><label>Reception Venue <span style="font-weight:300;color:var(--text-light);">(leave blank if same)</span></label><input type="text" id="receptionLocation" placeholder="Same as ceremony" oninput="liveUpdate()"></div>
                    <div class="ep-field"><label>Reception Address <span style="font-weight:300;color:var(--text-light);">(if different)</span></label><input type="text" id="receptionAddress" placeholder="Leave blank if same" oninput="liveUpdate()"></div>
                    <div class="ep-field"><label>Dress Code</label>
                        <select id="dressCode" onchange="liveUpdate()">
                            <option value="">Select dress code...</option>
                            <option>Black Tie</option><option>Formal</option><option>Cocktail Attire</option>
                            <option>Semi-Formal</option><option>Garden Party</option><option>Casual Chic</option>
                            <option>Casual</option><option>Outdoor / Come Comfortable</option>
                        </select>
                    </div>
                </div>

                <!-- SCHEDULE -->
                <div class="edit-panel" id="panel-schedule">
                    <h3>Day-of Schedule</h3>
                    <p class="ep-hint" style="margin-bottom:14px;">Add a timeline so guests know what to expect.</p>
                    <div id="scheduleItems"></div>
                    <button class="ep-add-btn" onclick="addScheduleItem()">+ Add Event</button>
                </div>

                <!-- WEDDING PARTY -->
                <div class="edit-panel" id="panel-party">
                    <h3>Wedding Party</h3>
                    <p class="ep-hint" style="margin-bottom:14px;">Add your bridesmaids, groomsmen, flower girls, and more. AI will write a blurb for each person when you generate.</p>
                    <div id="partyBlurbPreview" style="display:none;background:linear-gradient(135deg,#f9f5ff,#fff5f5);border:1px solid var(--blush-light);border-radius:8px;padding:12px 14px;margin-bottom:14px;">
                        <div style="font-size:0.75rem;font-weight:600;color:var(--blush);margin-bottom:8px;">‚ú¶ AI-WRITTEN BLURBS</div>
                        <div id="partyBlurbList" style="font-size:0.82rem;line-height:1.6;color:var(--text);"></div>
                    </div>
                    <div id="partyItems"></div>
                    <button class="ep-add-btn" onclick="addPartyMember()">+ Add Person</button>
                </div>

                <!-- GALLERY -->
                <div class="edit-panel" id="panel-gallery">
                    <h3>Gallery Photos</h3>
                    <p class="ep-hint" style="margin-bottom:14px;">Add engagement photos or your favorite pictures together.</p>
                    <div class="ep-photo-upload" onclick="document.getElementById('galleryPhotoInput').click()">
                        <input type="file" id="galleryPhotoInput" accept="image/*" multiple style="display:none" onchange="handlePhotoUpload(event)">
                        <div style="font-size:1.6rem;margin-bottom:6px;">üì∏</div>
                        <div style="font-size:0.82rem;color:var(--text-light);">Click to upload photos</div>
                        <div style="font-size:0.72rem;color:var(--border);margin-top:4px;">Up to 12 photos ¬∑ JPG or PNG</div>
                    </div>
                    <div class="ep-photo-grid" id="photoPreviewGrid"></div>
                </div>

                <!-- HOTELS -->
                <div class="edit-panel" id="panel-hotels">
                    <h3>Recommended Hotels</h3>
                    <p class="ep-hint" style="margin-bottom:14px;">Help guests find a place to stay.</p>
                    <div id="hotelItems"></div>
                    <button class="ep-add-btn" onclick="addHotel()">+ Add Hotel</button>
                </div>

                <!-- REGISTRY -->
                <div class="edit-panel" id="panel-registry">
                    <h3>Registry</h3>
                    <p class="ep-hint" style="margin-bottom:14px;">Haven't set yours up yet? <a href="https://www.amazon.com/wedding/home?tag=elegantbridec-20" target="_blank" style="color:var(--blush);">Amazon</a> and <a href="https://www.honeyfund.com/" target="_blank" style="color:var(--blush);">Honeyfund</a> are great places to start. Click below to get started.</p>
                    <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:14px;">
                        <label style="display:flex;align-items:center;gap:10px;padding:10px 12px;border:1.5px solid var(--border);border-radius:8px;cursor:pointer;font-size:0.85rem;transition:all 0.15s;" id="reg-amazon-wrap">
                            <input type="checkbox" name="registry" value="amazon" id="reg-amazon" onchange="updateRegStyle('amazon',this.checked);liveUpdate()"> üéÅ Amazon Registry
                        </label>
                        <label style="display:flex;align-items:center;gap:10px;padding:10px 12px;border:1.5px solid var(--border);border-radius:8px;cursor:pointer;font-size:0.85rem;transition:all 0.15s;" id="reg-honeyfund-wrap">
                            <input type="checkbox" name="registry" value="honeyfund" id="reg-honeyfund" onchange="updateRegStyle('honeyfund',this.checked);liveUpdate()"> üèù Honeyfund
                        </label>
                        <label style="display:flex;align-items:center;gap:10px;padding:10px 12px;border:1.5px solid var(--border);border-radius:8px;cursor:pointer;font-size:0.85rem;transition:all 0.15s;" id="reg-custom-wrap">
                            <input type="checkbox" name="registry" value="custom" id="reg-custom" onchange="updateRegStyle('custom',this.checked);document.getElementById('customRegistryFields').style.display=this.checked?'block':'none';document.getElementById('regUrlGuidance').style.display=this.checked?'block':'none';liveUpdate()"> üîó Other Registry
                        </label>
                    </div>
                    <div id="regUrlGuidance" style="display:none;background:#fff8e1;border:1px solid #ffe082;border-radius:8px;padding:12px;margin-bottom:10px;font-size:0.78rem;line-height:1.6;color:var(--text);">
                        <strong>üìã How to get your registry link:</strong><br>
                        <strong>Amazon:</strong> Go to your registry ‚Üí Share ‚Üí Copy the link.<br>
                        <strong>Honeyfund:</strong> Your page URL is honeyfund.com/your-name ‚Äî copy it from your browser.<br>
                        Then paste it in the "Registry URL" field below.
                    </div>
                    <div id="customRegistryFields" style="display:none;">
                        <div class="ep-field"><label>Registry Name</label><input type="text" id="customRegName" placeholder="e.g. Crate & Barrel" oninput="liveUpdate()"></div>
                        <div class="ep-field"><label>Registry URL</label><input type="text" id="customRegUrl" placeholder="https://..." oninput="liveUpdate()"></div>
                    </div>
                    <hr class="ep-section-divider">
                    <div class="ep-field">
                        <label>Message to Guests</label>
                        <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:10px;">
                            <div id="rmsg-wrap-0" onclick="document.querySelector('input[name=registryMsgOpt][value=\'0\']').checked=true;setRegistryMsg(0)" style="padding:10px 12px;border:1.5px solid var(--blush);border-radius:8px;cursor:pointer;font-size:0.82rem;line-height:1.5;background:var(--blush-light,#fdf0f0);">
                                <input type="radio" name="registryMsgOpt" value="0" checked style="display:none;"><strong>Classic</strong> ‚Äî Your presence is the greatest gift. But if you'd like to celebrate with something special, we're registered at:
                            </div>
                            <div id="rmsg-wrap-1" onclick="document.querySelector('input[name=registryMsgOpt][value=\'1\']').checked=true;setRegistryMsg(1)" style="padding:10px 12px;border:1.5px solid var(--border);border-radius:8px;cursor:pointer;font-size:0.82rem;line-height:1.5;background:white;">
                                <input type="radio" name="registryMsgOpt" value="1" style="display:none;"><strong>Experience</strong> ‚Äî Since we already have everything we need at home, we're celebrating with an experience instead. Your contribution to our honeymoon means the world!
                            </div>
                            <div id="rmsg-wrap-2" onclick="document.querySelector('input[name=registryMsgOpt][value=\'2\']').checked=true;setRegistryMsg(2)" style="padding:10px 12px;border:1.5px solid var(--border);border-radius:8px;cursor:pointer;font-size:0.82rem;line-height:1.5;background:white;">
                                <input type="radio" name="registryMsgOpt" value="2" style="display:none;"><strong>Casual</strong> ‚Äî No gifts necessary ‚Äî your love and presence are all we need. But if you insist, here's where we're registered:
                            </div>
                            <div id="rmsg-wrap-3" onclick="document.querySelector('input[name=registryMsgOpt][value=\'3\']').checked=true;setRegistryMsg(3)" style="padding:10px 12px;border:1.5px solid var(--border);border-radius:8px;cursor:pointer;font-size:0.82rem;line-height:1.5;background:white;">
                                <input type="radio" name="registryMsgOpt" value="3" style="display:none;"><strong>‚úèÔ∏è Write my own message</strong>
                            </div>
                        </div>
                        <textarea id="registryMessage" oninput="liveUpdate()" style="min-height:90px;display:none;" placeholder="Write your own message to guests..."></textarea>
                        <p class="ep-hint">This message appears above your registry links.</p>
                    </div>
                </div>

                <!-- PLANNING RESOURCES -->
                <div class="edit-panel" id="panel-resources">
                    <h3>Wedding Shops & Resources</h3>
                    <div style="background:var(--cream);border-radius:10px;padding:16px;margin-bottom:16px;text-align:center;">
                        <div style="font-size:1.4rem;margin-bottom:6px;">üå∏</div>
                        <div style="font-family:'Cormorant Garamond',serif;font-size:1.1rem;color:var(--text);margin-bottom:4px;">Elegant Bride Co.</div>
                        <div style="font-size:0.78rem;color:var(--text-light);line-height:1.5;margin-bottom:10px;">Free tools, shopping guides & inspiration for budget-conscious brides planning their perfect day, their way.</div>
                        <a href="https://www.elegantbrideco.com" target="_blank" style="display:inline-block;padding:8px 20px;background:var(--blush);color:white;border-radius:20px;text-decoration:none;font-size:0.8rem;font-weight:500;">Visit elegantbrideco.com ‚Üí</a>
                    </div>
                    <p class="ep-hint" style="margin-bottom:12px;">A small "Planned with Elegant Bride Co." credit will appear at the bottom of your website. We'd love to be part of your big day! üíï</p>
                    <div style="border:1.5px solid var(--border);border-radius:8px;padding:12px;background:white;">
                        <div style="font-size:0.75rem;font-weight:600;color:var(--text);margin-bottom:8px;">FREE RESOURCES FOR YOU</div>
                        <div style="display:flex;flex-direction:column;gap:6px;">
                            <a href="https://www.elegantbrideco.com/wedding-dresses" target="_blank" style="font-size:0.82rem;color:var(--blush);text-decoration:none;">üëó Shop Wedding Dresses</a>
                            <a href="https://www.elegantbrideco.com/wedding-invitations" target="_blank" style="font-size:0.82rem;color:var(--blush);text-decoration:none;">üíå Browse Invitations</a>
                            <a href="https://www.elegantbrideco.com" target="_blank" style="font-size:0.82rem;color:var(--blush);text-decoration:none;">üå∏ Wedding Planning Guide</a>
                            <a href="https://www.elegantbrideco.com/wedding-planner" target="_blank" style="font-size:0.82rem;color:var(--blush);text-decoration:none;">üìã Free Wedding Planner App</a>
                        </div>
                    </div>
                </div>
                <!-- THEME & TONE -->
                <div class="edit-panel" id="panel-theme">
                    <h3>Color Theme & Tone</h3>
                    <div style="font-size:0.78rem;font-weight:500;color:var(--text);margin-bottom:10px;">Heading Font</div>
                    <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:16px;" id="fontPicker">
                        <div onclick="setFont('cormorant')" id="font-cormorant" style="padding:10px 14px;border:1.5px solid var(--blush);border-radius:8px;cursor:pointer;background:var(--blush-light,#fdf0f0);">
                            <span style="font-family:'Cormorant Garamond',serif;font-size:1.3rem;font-weight:300;color:var(--text);">Cormorant</span>
                            <span style="font-size:0.7rem;color:var(--text-light);margin-left:8px;">Classic ¬∑ Romantic</span>
                        </div>
                        <div onclick="setFont('playfair')" id="font-playfair" style="padding:10px 14px;border:1.5px solid var(--border);border-radius:8px;cursor:pointer;background:white;">
                            <span style="font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:400;color:var(--text);">Playfair Display</span>
                            <span style="font-size:0.7rem;color:var(--text-light);margin-left:8px;">Bold ¬∑ Timeless</span>
                        </div>
                        <div onclick="setFont('raleway')" id="font-raleway" style="padding:10px 14px;border:1.5px solid var(--border);border-radius:8px;cursor:pointer;background:white;">
                            <span style="font-family:'Raleway',sans-serif;font-size:1.3rem;font-weight:300;color:var(--text);">Raleway</span>
                            <span style="font-size:0.7rem;color:var(--text-light);margin-left:8px;">Modern ¬∑ Minimal</span>
                        </div>
                        <div onclick="setFont('lato')" id="font-lato" style="padding:10px 14px;border:1.5px solid var(--border);border-radius:8px;cursor:pointer;background:white;">
                            <span style="font-family:'Lato',sans-serif;font-size:1.3rem;font-weight:300;color:var(--text);">Lato</span>
                            <span style="font-size:0.7rem;color:var(--text-light);margin-left:8px;">Clean ¬∑ Contemporary</span>
                        </div>
                    </div>
                    <div style="font-size:0.78rem;font-weight:500;color:var(--text);margin-bottom:10px;">Color Theme</div>
                    <div style="display:flex;flex-direction:column;gap:8px;" id="themePicker">
                        <div onclick="switchTheme('blush')" id="theme-blush" style="border:1.5px solid var(--blush);border-radius:10px;overflow:hidden;cursor:pointer;background:var(--blush-light,#fdf0f0);">
                            <input type="radio" name="eptheme" value="blush" class="ep-theme-opt" checked style="display:none;">
                            <div style="display:flex;height:28px;"><span style="flex:1;background:#D4A5A5;"></span><span style="flex:1;background:#F8F4F0;"></span><span style="flex:1;background:#A8B89C;"></span></div>
                            <div style="padding:8px 12px;"><strong style="font-size:0.82rem;">Blush & Sage</strong> <span style="font-size:0.72rem;color:var(--text-light);">‚Äî Soft, romantic, garden-inspired</span></div>
                        </div>
                        <div onclick="switchTheme('navy')" id="theme-navy" style="border:1.5px solid var(--border);border-radius:10px;overflow:hidden;cursor:pointer;background:white;">
                            <input type="radio" name="eptheme" value="navy" class="ep-theme-opt" style="display:none;">
                            <div style="display:flex;height:28px;"><span style="flex:1;background:#2C3E5D;"></span><span style="flex:1;background:#F5F0E8;"></span><span style="flex:1;background:#C9A96E;"></span></div>
                            <div style="padding:8px 12px;"><strong style="font-size:0.82rem;">Navy & Gold</strong> <span style="font-size:0.72rem;color:var(--text-light);">‚Äî Classic, formal, black-tie elegant</span></div>
                        </div>
                        <div onclick="switchTheme('sage')" id="theme-sage" style="border:1.5px solid var(--border);border-radius:10px;overflow:hidden;cursor:pointer;background:white;">
                            <input type="radio" name="eptheme" value="sage" class="ep-theme-opt" style="display:none;">
                            <div style="display:flex;height:28px;"><span style="flex:1;background:#7A9E7E;"></span><span style="flex:1;background:#F7F5F0;"></span><span style="flex:1;background:#C4A882;"></span></div>
                            <div style="padding:8px 12px;"><strong style="font-size:0.82rem;">Forest & Linen</strong> <span style="font-size:0.72rem;color:var(--text-light);">‚Äî Natural, earthy, outdoor ceremony</span></div>
                        </div>
                        <div onclick="switchTheme('ivory')" id="theme-ivory" style="border:1.5px solid var(--border);border-radius:10px;overflow:hidden;cursor:pointer;background:white;">
                            <input type="radio" name="eptheme" value="ivory" class="ep-theme-opt" style="display:none;">
                            <div style="display:flex;height:28px;"><span style="flex:1;background:#B5A898;"></span><span style="flex:1;background:#FAFAF7;"></span><span style="flex:1;background:#C8B89A;"></span></div>
                            <div style="padding:8px 12px;"><strong style="font-size:0.82rem;">Ivory & Champagne</strong> <span style="font-size:0.72rem;color:var(--text-light);">‚Äî Neutral, timeless, understated</span></div>
                        </div>
                        <div onclick="switchTheme('dustyrose')" id="theme-dustyrose" style="border:1.5px solid var(--border);border-radius:10px;overflow:hidden;cursor:pointer;background:white;">
                            <input type="radio" name="eptheme" value="dustyrose" class="ep-theme-opt" style="display:none;">
                            <div style="display:flex;height:28px;"><span style="flex:1;background:#C2848A;"></span><span style="flex:1;background:#FDF8F8;"></span><span style="flex:1;background:#9B7B8C;"></span></div>
                            <div style="padding:8px 12px;"><strong style="font-size:0.82rem;">Dusty Rose</strong> <span style="font-size:0.72rem;color:var(--text-light);">‚Äî Romantic, moody, floral accents ‚úø</span></div>
                        </div>
                        <div onclick="switchTheme('lavender')" id="theme-lavender" style="border:1.5px solid var(--border);border-radius:10px;overflow:hidden;cursor:pointer;background:white;">
                            <input type="radio" name="eptheme" value="lavender" class="ep-theme-opt" style="display:none;">
                            <div style="display:flex;height:28px;"><span style="flex:1;background:#9B8EC4;"></span><span style="flex:1;background:#F8F7FC;"></span><span style="flex:1;background:#B8A8C8;"></span></div>
                            <div style="padding:8px 12px;"><strong style="font-size:0.82rem;">Lavender</strong> <span style="font-size:0.72rem;color:var(--text-light);">‚Äî Dreamy, soft, whimsical ‚úø</span></div>
                        </div>
                    </div>

                </div>

            </div><!-- end edit-panels -->
        </div><!-- end left-panel -->

        <!-- RIGHT PANEL (live preview) -->
        <div class="right-panel">
            <div class="preview-bar">
                <div class="dot dot-r"></div><div class="dot dot-y"></div><div class="dot dot-g"></div>
                <div class="url-bar" id="previewUrl">yournames.netlify.app ‚Äî preview</div>
            </div>
            <div class="preview-wrap" id="previewWrap">
                <iframe id="previewFrame" title="Live Preview"></iframe>
                <div id="previewPlaceholder" style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;color:var(--text-light);pointer-events:none;">
                    <div style="font-size:3rem;">üíë</div>
                    <div style="font-family:'Cormorant Garamond',serif;font-size:1.4rem;color:var(--text);">Your website preview will appear here</div>
                    <div style="font-size:0.85rem;">Fill in your details and click <strong>‚ú¶ Generate Website</strong></div>
                </div>
            </div>
        </div>

    </div><!-- end editor-panels -->
</div><!-- end appScreen -->

<!-- GENERATING OVERLAY -->
<div id="generatingOverlay">
    <div class="gen-rings"><div class="gen-ring"></div><div class="gen-ring"></div><div class="gen-ring"></div></div>
    <div class="gen-title">Creating your wedding website‚Ä¶</div>
    <div class="gen-sub" id="genMessage">Writing your love story</div>
</div>

<!-- TOAST -->
<div id="toast"></div>

<script>
    // ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let generatedHTML = '';
    let generatedData = null;
    let generatedStoryCopy = '';
    let publishedSiteId = null;
    let publishedSiteUrl = null;
    let currentUser = null;
    let authToken = null;
    let uploadedPhotos = [];
    let heroPhoto = '';
    let scheduleItems = [{ time: '', event: '', note: '' }];
    let partyMembers = [];
    let hotelItems = [];
    let autoSaveTimer = null;
    let liveUpdateTimer = null;
    let msgInterval = null;

    const genMessages = ['Writing your love story...','Designing your website...','Building your gallery...','Adding the finishing touches...','Almost ready...'];

    // ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function switchAuthTab(tab) {
        document.getElementById('loginForm').style.display = tab === 'login' ? 'block' : 'none';
        document.getElementById('signupForm').style.display = tab === 'signup' ? 'block' : 'none';
        document.getElementById('loginTab').classList.toggle('active', tab === 'login');
        document.getElementById('signupTab').classList.toggle('active', tab === 'signup');
    }

    async function handleLogin() {
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;
        const errEl = document.getElementById('loginError');
        const btn = document.getElementById('loginBtn');
        errEl.style.display = 'none';
        if (!email || !password) { errEl.textContent = 'Please enter your email and password.'; errEl.style.display = 'block'; return; }
        btn.textContent = 'Signing in...'; btn.disabled = true;
        try {
            const res = await fetch('/auth', {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'login', email, password })
            });
            const data = await res.json();
            if (data.error) throw new Error(data.error);
            await loginSuccess(data.user, data.session);
        } catch (err) {
            errEl.textContent = err.message.includes('Invalid') ? 'Incorrect email or password.' : err.message;
            errEl.style.display = 'block';
            btn.textContent = 'Sign In'; btn.disabled = false;
        }
    }

    async function handleSignup() {
        const email = document.getElementById('signupEmail').value.trim();
        const password = document.getElementById('signupPassword').value;
        const password2 = document.getElementById('signupPassword2').value;
        const errEl = document.getElementById('signupError');
        const btn = document.getElementById('signupBtn');
        errEl.style.display = 'none';
        if (!email || !password) { errEl.textContent = 'Please fill in all fields.'; errEl.style.display = 'block'; return; }
        if (password.length < 6) { errEl.textContent = 'Password must be at least 6 characters.'; errEl.style.display = 'block'; return; }
        if (password !== password2) { errEl.textContent = "Passwords don\u0027t match."; errEl.style.display = 'block'; return; }
        btn.textContent = 'Creating account...'; btn.disabled = true;
        try {
            const res = await fetch('/auth', {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'signup', email, password })
            });
            const data = await res.json();
            if (data.error) throw new Error(data.error);
            await loginSuccess(data.user, data.session);
        } catch (err) {
            errEl.textContent = err.message;
            errEl.style.display = 'block';
            btn.textContent = 'Create Account'; btn.disabled = false;
        }
    }

    function handleGoogleSignIn() {
        showToast('Google sign-in coming soon! Please use email & password for now.');
    }

    async function loginSuccess(user, session) {
        currentUser = user;
        authToken = session?.access_token || null;
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('userPill').style.display = 'flex';
        document.getElementById('signOutBtn').style.display = 'block';
        document.getElementById('authScreen').style.display = 'none';
        document.getElementById('appScreen').classList.add('visible');
        renderSchedule(); renderParty(); renderHotels();
        // Try to load saved data
        await loadUserData();
    }

    function signOut() {
        currentUser = null; authToken = null;
        document.getElementById('userPill').style.display = 'none';
        document.getElementById('signOutBtn').style.display = 'none';
        document.getElementById('appScreen').classList.remove('visible');
        document.getElementById('authScreen').style.display = 'flex';
    }

    // ‚îÄ‚îÄ LOAD / SAVE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function loadUserData() {
        if (!authToken) return;
        try {
            const res = await fetch('/auth', {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'load', token: authToken })
            });
            const data = await res.json();
            if (data.site && data.site.form_data) {
                restoreFormData(data.site.form_data);
                if (data.site.generated_html) {
                    generatedHTML = data.site.generated_html;
                    generatedStoryCopy = data.site.story_copy || '';
                    generatedData = data.site.form_data;
                    publishedSiteId = data.site.site_id;
                    publishedSiteUrl = data.site.site_url;
                    document.getElementById('previewFrame').srcdoc = generatedHTML;
            showPreviewPlaceholder(false);
                    document.getElementById('previewUrl').textContent = (data.site.form_data.name1 || 'your') + '-and-' + (data.site.form_data.name2 || 'names') + '.netlify.app';
                    enableStoryEditor();
                    document.getElementById('publishBtn').style.display = 'flex';
                    setStepDone(1); setStepDone(2); setStepActive(3);
                    document.getElementById('toolbarStatus').textContent = 'Looking good! Edit anything and republish.';
                    if (publishedSiteUrl) showPublishedBanner(publishedSiteUrl);
                }
                showToast('Welcome back! Your progress has been loaded.');
            }
        } catch(e) { console.warn('Could not load saved data', e); }
    }

    function restoreFormData(d) {
        if (d.name1) document.getElementById('name1').value = d.name1;
        if (d.name2) document.getElementById('name2').value = d.name2;
        if (d.weddingDate) document.getElementById('weddingDate').value = d.weddingDate;
        if (d.ceremonyLocation) document.getElementById('ceremonyLocation').value = d.ceremonyLocation;
        if (d.ceremonyAddress) document.getElementById('ceremonyAddress').value = d.ceremonyAddress;
        if (d.ceremonyTime) document.getElementById('ceremonyTime').value = d.ceremonyTime;
        if (d.receptionLocation) document.getElementById('receptionLocation').value = d.receptionLocation;
        if (d.receptionAddress) document.getElementById('receptionAddress').value = d.receptionAddress;
        if (d.dressCode) document.getElementById('dressCode').value = d.dressCode;
        if (d.howMet) document.getElementById('howMet').value = d.howMet;
        if (d.proposal) document.getElementById('proposal').value = d.proposal;
        if (d.extraDetails) document.getElementById('extraDetails').value = d.extraDetails;
        if (d.theme) { const t = document.querySelector('input[name="eptheme"][value="' + d.theme + '"]'); if (t) t.checked = true; }
        if (d.tone) { const t = document.querySelector('input[name="tone"][value="' + d.tone + '"]'); if (t) t.checked = true; }
        if (d.schedule) { scheduleItems = d.schedule; renderSchedule(); }
        if (d.partyMembers) { partyMembers = d.partyMembers; renderParty(); }
        if (d.hotels) { hotelItems = d.hotels; renderHotels(); }
        if (d.photos) { uploadedPhotos = d.photos; renderPhotoThumbs(); }
        if (d.heroPhoto) {
            heroPhoto = d.heroPhoto;
            document.getElementById('heroPreviewPanel').innerHTML = '<img src="' + d.heroPhoto + '" style="width:100%;border-radius:8px;display:block;">';
            document.getElementById('heroRemoveBtn').style.display = 'block';
        }
        if (d.selectedRegistries) {
            d.selectedRegistries.forEach(v => {
                const cb = document.querySelector('input[name="registry"][value="' + v + '"]');
                if (cb) { cb.checked = true; updateRegStyle(v, true); }
            });
            if (d.selectedRegistries.includes('custom')) document.getElementById('customRegistryFields').style.display = 'block';
        }
        if (d.customRegName) document.getElementById('customRegName').value = d.customRegName;
        if (d.customRegUrl) document.getElementById('customRegUrl').value = d.customRegUrl;
        if (d.registryMessage) document.getElementById('registryMessage').value = d.registryMessage;
    }

    function collectFormData() {
        return {
            name1: document.getElementById('name1').value.trim(),
            name2: document.getElementById('name2').value.trim(),
            weddingDate: document.getElementById('weddingDate').value,
            ceremonyLocation: document.getElementById('ceremonyLocation').value.trim(),
            ceremonyAddress: document.getElementById('ceremonyAddress').value.trim(),
            ceremonyTime: document.getElementById('ceremonyTime').value,
            receptionLocation: document.getElementById('receptionLocation').value.trim(),
            receptionAddress: document.getElementById('receptionAddress').value.trim(),
            dressCode: document.getElementById('dressCode').value,
            howMet: document.getElementById('howMet').value.trim(),
            proposal: document.getElementById('proposal').value.trim(),
            extraDetails: document.getElementById('extraDetails').value.trim(),
            tone: (document.querySelector('input[name="tone"]:checked') || {}).value || 'romantic',
            theme: (document.querySelector('input[name="eptheme"]:checked') || {}).value || 'blush',
            headFont: fontMap[selectedFont] || fontMap.cormorant,
            customRegName: document.getElementById('customRegName').value.trim(),
            customRegUrl: document.getElementById('customRegUrl').value.trim(),
            registryMessage: (() => {
                const opt = document.querySelector('input[name="registryMsgOpt"]:checked');
                const idx = opt ? parseInt(opt.value) : 0;
                if (idx === 3) return document.getElementById('registryMessage').value.trim();
                return registryMsgPresets[idx] || registryMsgPresets[0];
            })(),
            selectedRegistries: Array.from(document.querySelectorAll('input[name="registry"]:checked')).map(cb => cb.value),
            photos: uploadedPhotos,
            heroPhoto: heroPhoto,
            schedule: scheduleItems,
            partyMembers: partyMembers,
            hotels: hotelItems,
            selectedResources: ['dresses','invitations','decorations','planner'].filter(id => document.getElementById('res-'+id)?.checked),
        };
    }

    function autoSave() {
        clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(async () => {
            if (!authToken || !generatedHTML) return;
            try {
                await fetch('/auth', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'save', token: authToken,
                        formData: collectFormData(),
                        generatedHtml: generatedHTML,
                        storyCopy: generatedStoryCopy,
                        siteId: publishedSiteId,
                        siteUrl: publishedSiteUrl
                    })
                });
            } catch(e) { console.warn('Auto-save failed', e); }
        }, 2000);
    }

    // ‚îÄ‚îÄ SECTION NAV ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let selectedFont = 'cormorant';
    const fontMap = {
        cormorant: "'Cormorant Garamond', serif",
        playfair:  "'Playfair Display', serif",
        raleway:   "'Raleway', sans-serif",
        lato:      "'Lato', sans-serif"
    };
    function setFont(name) {
        selectedFont = name;
        ['cormorant','playfair','raleway','lato'].forEach(f => {
            const el = document.getElementById('font-' + f);
            if (!el) return;
            el.style.borderColor = f === name ? 'var(--blush)' : 'var(--border)';
            el.style.background = f === name ? 'var(--blush-light,#fdf0f0)' : 'white';
        });
        if (generatedData) {
            generatedData.headFont = fontMap[name];
            const html = buildWebsiteHTML(generatedData, generatedStoryCopy);
            generatedHTML = html;
            document.getElementById('previewFrame').srcdoc = html;
            autoSave();
        }
    }
    const sectionTitles = {
        names: 'Names & Date', photo: 'Couple Photo', story: 'Your Story', resources: 'Shops & Resources',
        details: 'Wedding Details', schedule: 'Schedule', party: 'Wedding Party',
        gallery: 'Gallery Photos', hotels: 'Hotels', registry: 'Registry', theme: 'Color Theme & Tone'
    };
    function showSection(name) {
        document.querySelectorAll('.icon-nav-item').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.edit-panel').forEach(el => el.classList.remove('active'));
        document.getElementById('nav-' + name).classList.add('active');
        document.getElementById('panel-' + name).classList.add('active');
        const h = document.getElementById('leftPanelHeader');
        if (h) h.textContent = sectionTitles[name] || name;
    }

    // ‚îÄ‚îÄ PREVIEW MODE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function setPreviewMode(mode) {
        const wrap = document.getElementById('previewWrap');
        const dBtn = document.getElementById('deskBtn');
        const mBtn = document.getElementById('mobileBtn');
        wrap.className = 'preview-wrap' + (mode === 'mobile' ? ' mobile' : '');
        dBtn.classList.toggle('active', mode === 'desktop');
        mBtn.classList.toggle('active', mode === 'mobile');
    }

    // ‚îÄ‚îÄ LIVE UPDATE (rebuilds preview without AI) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function liveUpdate() {
        if (!generatedHTML || !generatedData) return;
        clearTimeout(liveUpdateTimer);
        liveUpdateTimer = setTimeout(() => {
            const d = collectFormData();
            generatedData = { ...generatedData, ...d };
            const html = buildWebsiteHTML(generatedData, generatedStoryCopy);
            generatedHTML = html;
            document.getElementById('previewFrame').srcdoc = html;
            autoSave();
        }, 600);
    }

    // ‚îÄ‚îÄ STEPS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function setStepDone(n) { const el = document.getElementById('sd'+n); if(el){el.classList.add('done');el.classList.remove('active');el.textContent='‚úì';} }
    function setStepActive(n) { const el = document.getElementById('sd'+n); if(el){el.classList.add('active');el.classList.remove('done');} }

    // ‚îÄ‚îÄ HERO PHOTO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function handleHeroPhoto(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const MAX_W = 1400, MAX_H = 700;
                let w = img.width, h = img.height;
                if (w > MAX_W) { h = h * MAX_W / w; w = MAX_W; }
                if (h > MAX_H) { w = w * MAX_H / h; h = MAX_H; }
                canvas.width = w; canvas.height = h;
                canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                heroPhoto = canvas.toDataURL('image/jpeg', 0.82);
                document.getElementById('heroPreviewPanel').innerHTML = '<img src="' + heroPhoto + '" style="width:100%;border-radius:8px;display:block;">';
                document.getElementById('heroRemoveBtn').style.display = 'block';
                liveUpdate();
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }

    function removeHeroPhoto() {
        heroPhoto = '';
        document.getElementById('heroPreviewPanel').innerHTML = '<div style="font-size:1.8rem;margin-bottom:6px;">üì∑</div>';
        document.getElementById('heroRemoveBtn').style.display = 'none';
        liveUpdate();
    }

    // ‚îÄ‚îÄ GALLERY PHOTOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function handlePhotoUpload(event) {
        const files = Array.from(event.target.files);
        const remaining = 12 - uploadedPhotos.length;
        files.slice(0, remaining).forEach(file => {
            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedPhotos.push({ src: e.target.result, name: file.name });
                renderPhotoThumbs();
                liveUpdate();
            };
            reader.readAsDataURL(file);
        });
    }

    function renderPhotoThumbs() {
        document.getElementById('photoPreviewGrid').innerHTML = uploadedPhotos.map((p, i) => `
            <div class="ep-photo-thumb">
                <img src="${p.src}" alt="Photo ${i+1}">
                <button onclick="removePhoto(${i})">‚úï</button>
            </div>
        `).join('');
    }

    function removePhoto(i) { uploadedPhotos.splice(i, 1); renderPhotoThumbs(); liveUpdate(); }

    // ‚îÄ‚îÄ SCHEDULE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderSchedule() {
        document.getElementById('scheduleItems').innerHTML = scheduleItems.map((item, i) => `
            <div class="ep-item">
                <button class="ep-item-remove" onclick="removeScheduleItem(${i})">‚úï</button>
                <div class="ep-field-row">
                    <div class="ep-field"><label>Time</label><input type="time" value="${item.time}" onchange="scheduleItems[${i}].time=this.value;liveUpdate()"></div>
                    <div class="ep-field"><label>Event</label><input type="text" value="${item.event}" placeholder="e.g. Ceremony" onchange="scheduleItems[${i}].event=this.value;liveUpdate()"></div>
                </div>
                <div class="ep-field"><label>Note <span style="font-weight:300;color:var(--text-light);">(optional)</span></label><input type="text" value="${item.note||''}" placeholder="e.g. Black tie optional" onchange="scheduleItems[${i}].note=this.value;liveUpdate()"></div>
            </div>
        `).join('');
    }

    function addScheduleItem() { scheduleItems.push({ time: '', event: '', note: '' }); renderSchedule(); }
    function removeScheduleItem(i) { scheduleItems.splice(i, 1); renderSchedule(); liveUpdate(); }

    // ‚îÄ‚îÄ WEDDING PARTY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function handlePartyPhoto(event, i) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const size = 300;
                canvas.width = size; canvas.height = size;
                const ctx = canvas.getContext('2d');
                const scale = Math.max(size/img.width, size/img.height);
                const x = (size - img.width*scale)/2;
                const y = (size - img.height*scale)/2;
                ctx.drawImage(img, x, y, img.width*scale, img.height*scale);
                partyMembers[i].photo = canvas.toDataURL('image/jpeg', 0.8);
                renderParty(); liveUpdate();
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
    function renderParty() {
        document.getElementById('partyItems').innerHTML = partyMembers.map((p, i) => {
            const tone = p.tone || 'sweet';
            const photoHtml = p.photo
                ? '<img src="' + p.photo + '" style="width:48px;height:48px;border-radius:50%;object-fit:cover;border:2px solid var(--border);flex-shrink:0;">'
                : '<div style="width:48px;height:48px;border-radius:50%;background:var(--warm-gray);display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;">üë§</div>';
            const removePhotoBtn = p.photo ? '<button onclick="partyMembers[' + i + '].photo=\'\';renderParty();liveUpdate();" style="background:none;border:none;color:var(--text-light);font-size:0.75rem;cursor:pointer;text-decoration:underline;">Remove</button>' : '';
            return '<div class="ep-item">' +
                '<button class="ep-item-remove" onclick="removePartyMember(' + i + ')">‚úï</button>' +
                '<div class="ep-field"><label>Name</label><input type="text" value="' + (p.name||'') + '" placeholder="Full name" onchange="partyMembers[' + i + '].name=this.value;liveUpdate()"></div>' +
                '<div class="ep-field"><label>Role</label><input type="text" value="' + (p.role||'') + '" placeholder="e.g. Maid of Honor" onchange="partyMembers[' + i + '].role=this.value;liveUpdate()"></div>' +
                '<div class="ep-field"><label>Relation</label><input type="text" value="' + (p.relation||'') + '" placeholder="e.g. Best Friend" onchange="partyMembers[' + i + '].relation=this.value;liveUpdate()"></div>' +
                '<div class="ep-field"><label>Photo <span style=\"font-weight:300;color:var(--text-light);\">(optional)</span></label>' +
                '<div style=\"display:flex;align-items:center;gap:10px;margin-top:4px;\">' + photoHtml +
                '<div><label style=\"cursor:pointer;font-size:0.78rem;color:var(--blush);text-decoration:underline;\">' +
                (p.photo ? 'Change photo' : 'Upload photo') +
                '<input type=\"file\" accept=\"image/*\" style=\"display:none;\" onchange=\"handlePartyPhoto(event,' + i + ')\"></label>' +
                (p.photo ? '<br>' + removePhotoBtn : '') + '</div></div></div>' +
                '<div class="ep-field"><label>Note for AI blurb</label><input type="text" value="' + (p.note||'') + '" placeholder="Fun fact or personality" onchange="partyMembers[' + i + '].note=this.value"></div>' +
                '<div class="ep-field"><label>Blurb Tone</label><select onchange="partyMembers[' + i + '].tone=this.value">' +
                '<option value="sweet" ' + (tone==='sweet'?'selected':'') + '>Sweet</option>' +
                '<option value="funny" ' + (tone==='funny'?'selected':'') + '>Funny</option>' +
                '<option value="heartfelt" ' + (tone==='heartfelt'?'selected':'') + '>Heartfelt</option>' +
                '<option value="classic" ' + (tone==='classic'?'selected':'') + '>Classic</option>' +
                '<option value="roast" ' + (tone==='roast'?'selected':'') + '>Roast</option>' +
                '</select></div></div>';
        }).join('');
    }
    function addPartyMember() { partyMembers.push({ name: '', role: '', relation: '', note: '', tone: 'sweet' }); renderParty(); }
    function removePartyMember(i) { partyMembers.splice(i, 1); renderParty(); liveUpdate(); }

    // ‚îÄ‚îÄ HOTELS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderHotels() {
        document.getElementById('hotelItems').innerHTML = hotelItems.map((h, i) => `
            <div class="ep-item">
                <button class="ep-item-remove" onclick="removeHotel(${i})">‚úï</button>
                <div class="ep-field"><label>Hotel Name</label><input type="text" value="${h.name||''}" placeholder="e.g. The Grand Hotel" onchange="hotelItems[${i}].name=this.value;liveUpdate()"></div>
                <div class="ep-field"><label>Price Range</label>
                    <select onchange="hotelItems[${i}].price=this.value;liveUpdate()">
                        <option value="" ${!h.price?'selected':''}>Select price range...</option>
                        <option value="Under $100/night" ${h.price==='Under $100/night'?'selected':''}>Under $100/night</option>
                        <option value="$100‚Äì$150/night" ${h.price==='$100‚Äì$150/night'?'selected':''}>$100‚Äì$150/night</option>
                        <option value="$150‚Äì$200/night" ${h.price==='$150‚Äì$200/night'?'selected':''}>$150‚Äì$200/night</option>
                        <option value="$200‚Äì$250/night" ${h.price==='$200‚Äì$250/night'?'selected':''}>$200‚Äì$250/night</option>
                        <option value="$250‚Äì$300/night" ${h.price==='$250‚Äì$300/night'?'selected':''}>$250‚Äì$300/night</option>
                        <option value="$300+/night" ${h.price==='$300+/night'?'selected':''}>$300+/night</option>
                    </select>
                </div>
                <div class="ep-field"><label>Address <span style="font-weight:300;color:var(--text-light);">(for map)</span></label><input type="text" value="${h.address||''}" placeholder="e.g. 123 Main St, Austin TX" onchange="hotelItems[${i}].address=this.value;liveUpdate()"></div>
                <div class="ep-field"><label>Note <span style="font-weight:300;color:var(--text-light);">(optional)</span></label><input type="text" value="${h.note||''}" placeholder="e.g. Ask for the wedding rate" onchange="hotelItems[${i}].note=this.value;liveUpdate()"></div>
                <div class="ep-field"><label>Booking URL <span style="font-weight:300;color:var(--text-light);">(optional)</span></label><input type="text" value="${h.bookingUrl||''}" placeholder="https://..." onchange="hotelItems[${i}].bookingUrl=this.value;liveUpdate()"></div>
            </div>
        `).join('');
    }

    function addHotel() { hotelItems.push({ name: '', price: '', address: '', note: '', bookingUrl: '' }); renderHotels(); }
    function removeHotel(i) { hotelItems.splice(i, 1); renderHotels(); liveUpdate(); }

    // ‚îÄ‚îÄ REGISTRY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const registryMsgPresets = [
        "Your presence is the greatest gift. But if you'd like to celebrate with something special, we're registered at:",
        "Since we already have everything we need at home, we're celebrating with an experience instead. Your contribution to our honeymoon means the world!",
        "No gifts necessary ‚Äî your love and presence are all we need. But if you insist, here's where we're registered:",
        null // freehand
    ];
    function setRegistryMsg(idx) {
        const ta = document.getElementById('registryMessage');
        if (idx === 3) {
            ta.style.display = 'block';
            ta.value = '';
        } else {
            ta.style.display = 'none';
            ta.value = registryMsgPresets[idx];
        }
        // highlight selected
        [0,1,2,3].forEach(i => {
            const w = document.getElementById('rmsg-wrap-' + i);
            if (w) { w.style.borderColor = i === idx ? 'var(--blush)' : 'var(--border)'; w.style.background = i === idx ? 'var(--blush-light, #fdf0f0)' : 'white'; }
        });
        liveUpdate();
    }
    // Init on load
    document.addEventListener('DOMContentLoaded', () => setRegistryMsg(0));
    function updateResStyle(id, checked) {
        const wrap = document.getElementById('res-' + id + '-wrap');
        if (wrap) { wrap.style.borderColor = checked ? 'var(--blush)' : 'var(--border)'; wrap.style.background = checked ? 'var(--blush-light,#fdf0f0)' : 'white'; }
    }
    // init resource styles on load
    document.addEventListener('DOMContentLoaded', () => {
        ['dresses','invitations','decorations','planner'].forEach(id => updateResStyle(id, true));
    });
    function updateRegStyle(id, checked) {
        const wrap = document.getElementById('reg-' + id + '-wrap');
        if (wrap) {
            wrap.style.borderColor = checked ? 'var(--blush)' : 'var(--border)';
            wrap.style.background = checked ? 'var(--blush-light, #fdf0f0)' : 'white';
        }
    }

    // ‚îÄ‚îÄ STORY EDITOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function enableStoryEditor() {
        const editor = document.getElementById('storyEditor');
        editor.contentEditable = 'true';
        editor.style.background = 'white';
        editor.style.color = 'var(--text)';
        document.getElementById('applyStoryBtn').style.display = 'block';
        if (generatedStoryCopy) editor.innerHTML = generatedStoryCopy;
    }

    function applyStoryEdit() {
        generatedStoryCopy = document.getElementById('storyEditor').innerHTML;
        const d = collectFormData();
        generatedData = { ...generatedData, ...d };
        const html = buildWebsiteHTML(generatedData, generatedStoryCopy);
        generatedHTML = html;
        document.getElementById('previewFrame').srcdoc = html;
        showToast('Story updated!');
        autoSave();
    }

    // ‚îÄ‚îÄ THEME SWITCH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function switchTheme(newTheme) {
        // Update radio
        const radio = document.querySelector('input[name="eptheme"][value="' + newTheme + '"]');
        if (radio) radio.checked = true;
        // Highlight theme cards
        ['blush','navy','sage','ivory','dustyrose','lavender'].forEach(t => {
            const el = document.getElementById('theme-' + t);
            if (!el) return;
            el.style.borderColor = t === newTheme ? 'var(--blush)' : 'var(--border)';
            el.style.background = t === newTheme ? 'var(--blush-light,#fdf0f0)' : 'white';
        });
        if (!generatedData) return;
        generatedData.theme = newTheme;
        const html = buildWebsiteHTML(generatedData, generatedStoryCopy);
        generatedHTML = html;
        document.getElementById('previewFrame').srcdoc = html;
        autoSave();
    }

    // ‚îÄ‚îÄ PUBLISHED BANNER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showPublishedBanner(url) {
        const banner = document.getElementById('publishedBanner');
        const urlEl = document.getElementById('publishedUrl');
        urlEl.href = url; urlEl.textContent = url;
        banner.style.display = 'block';
        const chip = document.getElementById('publishedChip');
        chip.href = url; chip.style.display = 'flex';
        document.getElementById('previewUrl').textContent = url.replace('https://', '');
    }

    function copyPublishedUrl() {
        if (!publishedSiteUrl) return;
        navigator.clipboard.writeText(publishedSiteUrl).then(() => showToast('Link copied!'));
    }

    // ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showPreviewPlaceholder(show) {
        const p = document.getElementById('previewPlaceholder');
        if (p) p.style.display = show ? 'flex' : 'none';
    }

    function showToast(msg, dur = 3000) {
        const t = document.getElementById('toast');
        t.textContent = msg; t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), dur);
    }

    // ‚îÄ‚îÄ GENERATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function generateWebsite() {
        const data = collectFormData();
        if (!data.name1 || !data.name2) { showSection('names'); showToast('Please enter both names first!'); return; }
        if (!data.howMet) { showSection('story'); showToast('Please tell us how you met!'); return; }

        document.getElementById('generatingOverlay').classList.add('visible');
        showPreviewPlaceholder(false);
        let mi = 0;
        msgInterval = setInterval(() => {
            mi = (mi + 1) % genMessages.length;
            document.getElementById('genMessage').textContent = genMessages[mi];
        }, 3000);

        setStepDone(1); setStepActive(2);

        const toneGuide = {
            romantic: 'Warm, poetic, deeply heartfelt.',
            humorous: 'Funny, lighthearted, witty.',
            modern: 'Clean, direct, confident. No flowery language.',
            whimsical: 'Dreamy, fairytale-inspired.',
            classic: 'Timeless, elegant, graceful.'
        };

        const partyWithNotes = data.partyMembers.filter(p => p.name && p.role);
        const partyInstruction = partyWithNotes.length > 0 ? `

Also write a short 2-3 sentence blurb for each wedding party member. After the story HTML, output:
PARTY_BLURBS_START
[{"name":"...","blurb":"..."}]
PARTY_BLURBS_END

Wedding party:
${partyWithNotes.map(p => `- ${p.name} (${p.role}${p.relation ? ', ' + p.relation : ''}): Tone: ${p.tone || 'Sweet'}. About them: ${p.note || 'No info provided'}`).join('\n')}` : '';

        const prompt = `Write the "Our Story" section for ${data.name1} and ${data.name2}'s wedding website.

How they met: ${data.howMet}
The proposal: ${data.proposal || 'Not provided'}
Extra details: ${data.extraDetails || 'None'}

Tone: ${toneGuide[data.tone]}

Write 2-3 paragraphs as HTML <p> tags. Then add one memorable pull quote wrapped in: <div class="story-pull" style="font-style:italic;text-align:center;padding:28px 0;border-top:1px solid currentColor;border-bottom:1px solid currentColor;margin:32px 0;opacity:0.8;font-size:1.15rem;line-height:1.5;font-family:Georgia,serif;">quote here</div>${partyInstruction}

Output the story HTML first. Nothing else unless party blurbs were requested.`;

        try {
            const res = await fetch('/generate', {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ messages: [{ role: 'user', content: prompt }] })
            });
            const result = await res.json();
            const rawText = result.content?.[0]?.text || '<p>A beautiful love story.</p>';
            let storyCopy = rawText;
            let partyBlurbs = {};
            if (rawText.includes('PARTY_BLURBS_START')) {
                const parts = rawText.split('PARTY_BLURBS_START');
                storyCopy = parts[0].trim();
                try { const blurbArr = JSON.parse(parts[1].split('PARTY_BLURBS_END')[0].trim()); blurbArr.forEach(b => { partyBlurbs[b.name] = b.blurb; }); } catch(e) {}
            }
            data.partyBlurbs = partyBlurbs;
            // Show blurbs in party panel
            if (Object.keys(partyBlurbs).length > 0) {
                const preview = document.getElementById('partyBlurbPreview');
                const list = document.getElementById('partyBlurbList');
                if (preview && list) {
                    preview.style.display = 'block';
                    list.innerHTML = Object.entries(partyBlurbs).map(([name, blurb]) =>
                        '<div style="margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid rgba(0,0,0,0.06);last-child{border:none}"><strong style=\"color:var(--blush);\">' + name + '</strong><br><em>"' + blurb + '"</em></div>'
                    ).join('');
                }
            }
            clearInterval(msgInterval);
            generatedStoryCopy = storyCopy;
            generatedData = data;
            generatedHTML = buildWebsiteHTML(data, storyCopy);

            document.getElementById('previewFrame').srcdoc = generatedHTML;
            document.getElementById('previewUrl').textContent = (data.name1 + '-and-' + data.name2).toLowerCase().replace(/\s+/g, '-') + '.netlify.app';
            document.getElementById('generatingOverlay').classList.remove('visible');
            document.getElementById('publishBtn').style.display = 'flex';
            setStepDone(2); setStepActive(3);
            document.getElementById('toolbarStatus').textContent = 'Looking great! Publish when ready.';

            enableStoryEditor();
            showSection('story');
            showToast('Your website is ready! Review it and publish when you\'re happy.');
            autoSave();

        } catch(err) {
            clearInterval(msgInterval);
            document.getElementById('generatingOverlay').classList.remove('visible');
            showToast('Something went wrong. Please try again.');
            console.error(err);
        }
    }

    // ‚îÄ‚îÄ PUBLISH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function publishWebsite() {
        if (!generatedHTML) { showToast('Generate your website first!'); return; }
        const btn = document.getElementById('publishBtn');
        const origHTML = btn.innerHTML;
        btn.innerHTML = '‚è≥ Publishing...'; btn.disabled = true;

        const d = collectFormData();
        const siteName = (d.name1 + '-and-' + d.name2).toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');

        try {
            const res = await fetch('/deploy-site', {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ html: generatedHTML, siteName, projectName: publishedSiteId })
            });
            const result = await res.json();
            if (result.error) throw new Error(result.error);

            publishedSiteId = result.projectName;
            publishedSiteUrl = result.url;
            showPublishedBanner(publishedSiteUrl);
            btn.innerHTML = '‚úì Published!';
            setTimeout(() => { btn.innerHTML = 'üîÑ Update Site'; btn.disabled = false; }, 3000);
            showToast('üéâ Your wedding website is live!', 5000);
            autoSave();

        } catch(err) {
            btn.innerHTML = origHTML; btn.disabled = false;
            showToast('Publishing failed: ' + err.message);
        }
    }

    function getTheme(name) {
        const themes = {
            blush:    { primary:'#D4A5A5', primaryDark:'#B88A8A', accent:'#A8B89C', bg:'#FBF8F5', light:'#F0E8E8', text:'#4A4540', headFont:"'Cormorant Garamond', serif", bodyFont:"'Jost', sans-serif", floral:false },
            navy:     { primary:'#2C3E5D', primaryDark:'#1E2D45', accent:'#C9A96E', bg:'#F5F0E8', light:'#E8E0D0', text:'#2C3040', headFont:"'Playfair Display', serif", bodyFont:"'Lato', sans-serif", floral:false },
            sage:     { primary:'#7A9E7E', primaryDark:'#5E8563', accent:'#C4A882', bg:'#F7F5F0', light:'#E0EAE0', text:'#3A3830', headFont:"'Cormorant Garamond', serif", bodyFont:"'Raleway', sans-serif", floral:false },
            ivory:    { primary:'#B5A898', primaryDark:'#9A8D7E', accent:'#C8B89A', bg:'#FAFAF7', light:'#F0EDE8', text:'#4A4540', headFont:"'Cormorant Garamond', serif", bodyFont:"'Jost', sans-serif", floral:false },
            dustyrose:{ primary:'#C2848A', primaryDark:'#A96870', accent:'#9B7B8C', bg:'#FDF8F8', light:'#F5E8EC', text:'#4A3840', headFont:"'Cormorant Garamond', serif", bodyFont:"'Jost', sans-serif", floral:true },
            lavender: { primary:'#9B8EC4', primaryDark:'#7B6EA4', accent:'#B8A8C8', bg:'#F8F7FC', light:'#EDE8F5', text:'#3A3848', headFont:"'Cormorant Garamond', serif", bodyFont:"'Jost', sans-serif", floral:true }
        };
        return themes[name] || themes.blush;
    }

    function buildWebsiteHTML(data, storyCopy) {
        const t = getTheme(data.theme);
        if (data.headFont) t.headFont = data.headFont;
        const wDate = data.weddingDate ? new Date(data.weddingDate + 'T12:00:00') : null;
        const fDate = wDate ? wDate.toLocaleDateString('en-US', {weekday:'long',year:'numeric',month:'long',day:'numeric'}) : '';
        const fTime = data.ceremonyTime ? new Date('2000-01-01T' + data.ceremonyTime).toLocaleTimeString('en-US', {hour:'numeric',minute:'2-digit'}) : '';
        const reception = (data.receptionLocation && data.receptionLocation.trim()) ? data.receptionLocation : data.ceremonyLocation;

        // Map variables (used in details section)
        const ceremonyAddr = data.ceremonyAddress || data.ceremonyLocation;
        const receptionAddr = (data.receptionAddress && data.receptionAddress.trim()) ? data.receptionAddress : (data.receptionLocation && data.receptionLocation !== data.ceremonyLocation ? data.receptionLocation : null);
        const hasDualMap = ceremonyAddr && receptionAddr;

        // Hotels
        const validHotels = (data.hotels || []).filter(h => h.name);

        // Registry links
        const registryLinks = {
            amazon:    { name: 'Amazon Registry', url: 'https://www.amazon.com/wedding/home?tag=elegantbridec-20', emoji: '&#127873;' },
            honeyfund: { name: 'Honeyfund', url: 'https://www.honeyfund.com/', emoji: '&#127965;' },
        };
        if (data.customRegName && data.customRegUrl) registryLinks.custom = { name: data.customRegName, url: data.customRegUrl, emoji: '&#128279;' };

        const selectedRegistries = data.selectedRegistries.map(key => registryLinks[key]).filter(Boolean);

        const registrySection = selectedRegistries.length > 0 ? `
        <section id="registry" style="padding:80px 20px;background:${t.light};">
          <div style="max-width:700px;margin:0 auto;text-align:center;">
            
            <h2 style="font-family:${t.headFont};font-size:clamp(1.8rem,4vw,2.6rem);font-weight:300;color:${t.text};margin-bottom:16px;">Registry</h2>
            <p style="font-size:1rem;line-height:1.8;color:${t.text};opacity:0.75;max-width:500px;margin:0 auto 28px;font-weight:300;">${data.registryMessage || 'Your presence is the greatest gift. But if you\'d like to celebrate with something special, we\'re registered at:'}</p>
            <div style="display:flex;gap:14px;justify-content:center;flex-wrap:wrap;">
              ${selectedRegistries.map((r, i) => `<a href="${r.url}" target="_blank" style="display:inline-flex;align-items:center;gap:8px;padding:14px 28px;border-radius:50px;${i===0 ? `background:${t.primary};color:white;` : `background:white;color:${t.primary};border:2px solid ${t.primary};`}text-decoration:none;font-size:0.9rem;font-weight:500;letter-spacing:0.04em;">${r.emoji} ${r.name}</a>`).join('')}
            </div>
          </div>
        </section>` : '';

        // Gallery section
        const gallerySection = data.photos && data.photos.length > 0 ? `
        <section id="gallery" style="padding:80px 20px;background:${t.bg};">
          <div style="max-width:800px;margin:0 auto;text-align:center;">
            
            <h2 style="font-family:${t.headFont};font-size:clamp(1.8rem,4vw,2.6rem);font-weight:300;color:${t.text};margin-bottom:36px;">Our Gallery</h2>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;">
              ${data.photos.map(p => `<div class="eb-deletable eb-photo-wrap" style="border-radius:12px;overflow:hidden;aspect-ratio:4/3;position:relative;"><img src="${p.src}" class="eb-photo" alt="Wedding photo" style="width:100%;height:100%;object-fit:cover;display:block;"></div>`).join('')}
            </div>
          </div>
        </section>` : '';

        // Schedule section
        const validSchedule = data.schedule.filter(s => s.time && s.event);
        const scheduleSection = validSchedule.length > 0 ? `
        <section id="schedule" style="padding:80px 20px;background:${t.light};">
          <div style="max-width:600px;margin:0 auto;text-align:center;">
            
            <h2 style="font-family:${t.headFont};font-size:clamp(1.8rem,4vw,2.6rem);font-weight:300;color:${t.text};margin-bottom:36px;">Day-of Schedule</h2>
            <div style="text-align:left;">
              ${validSchedule.map(s => {
                const fTime = new Date('2000-01-01T' + s.time).toLocaleTimeString('en-US', {hour:'numeric',minute:'2-digit'});
                return `<div style="display:flex;gap:20px;margin-bottom:24px;align-items:flex-start;">
                  <div style="min-width:80px;text-align:right;font-size:0.85rem;font-weight:600;color:${t.primary};padding-top:2px;">${fTime}</div>
                  <div style="width:10px;height:10px;border-radius:50%;background:${t.primary};flex-shrink:0;margin-top:4px;box-shadow:0 0 0 3px ${t.light},0 0 0 4px ${t.primary};"></div>
                  <div>
                    <div style="font-weight:500;color:${t.text};">${s.event}</div>
                    ${s.note ? `<div style="font-size:0.85rem;color:${t.text};opacity:0.55;margin-top:2px;">${s.note}</div>` : ''}
                  </div>
                </div>`;
              }).join('')}
            </div>
          </div>
        </section>` : '';

        // Wedding party section
        const validParty = data.partyMembers.filter(p => p.name && p.role);
        const partySection = validParty.length > 0 ? `
        <section id="party" style="padding:80px 20px;background:${t.bg};">
          <div style="max-width:860px;margin:0 auto;text-align:center;">
            
            <h2 style="font-family:${t.headFont};font-size:clamp(1.8rem,4vw,2.6rem);font-weight:300;color:${t.text};margin-bottom:36px;">Wedding Party</h2>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;text-align:left;">
              ${validParty.map(p => `
                <div style="background:white;border-radius:14px;padding:24px 20px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 2px 12px rgba(0,0,0,0.04);text-align:center;">
                  ${p.photo
                    ? `<img src="${p.photo}" class="eb-photo" style="width:80px;height:80px;border-radius:50%;object-fit:cover;margin:0 auto 14px;display:block;border:3px solid ${t.light};">`
                    : `<div style="width:80px;height:80px;border-radius:50%;background:${t.light};margin:0 auto 14px;display:flex;align-items:center;justify-content:center;font-size:1.6rem;">&#128100;</div>`
                  }
                  <div class="eb-text" style="font-weight:600;color:${t.text};margin-bottom:2px;font-size:1rem;">${p.name}</div>
                  <div class="eb-text" style="font-size:0.72rem;color:${t.primary};font-weight:600;letter-spacing:0.06em;text-transform:uppercase;margin-bottom:4px;">${p.role}</div>
                  ${p.relation ? `<div style="font-size:0.78rem;color:${t.text};opacity:0.45;margin-bottom:10px;">${p.relation}</div>` : '<div style="margin-bottom:10px;"></div>'}
                  ${data.partyBlurbs && data.partyBlurbs[p.name] ? `<div style="font-size:0.85rem;color:${t.text};opacity:0.7;line-height:1.6;font-style:italic;border-top:1px solid rgba(0,0,0,0.06);padding-top:10px;text-align:left;">"${data.partyBlurbs[p.name]}"</div>` : ''}
                </div>
              `).join('')}
            </div>
          </div>
        </section>` : '';

        // Accommodations section with maps
        const mapSection = validHotels.length > 0 ? `
        <section id="hotels" style="padding:80px 20px;background:${t.light};">
          <div style="max-width:860px;margin:0 auto;">
            <div style="text-align:center;margin-bottom:40px;">
              <h2 style="font-family:${t.headFont};font-size:clamp(1.8rem,4vw,2.6rem);font-weight:300;color:${t.text};">Recommended Hotels</h2>
            </div>
            <div style="display:flex;flex-direction:column;gap:24px;">
              ${validHotels.map(h => `
              <div class="eb-deletable" style="background:white;border-radius:14px;overflow:hidden;border:1px solid rgba(0,0,0,0.06);box-shadow:0 2px 12px rgba(0,0,0,0.05);display:grid;grid-template-columns:1fr ${h.address ? '1fr' : ''};gap:0;">
                <div style="padding:24px;">
                  <div class="eb-text" style="font-weight:600;color:${t.text};font-size:1rem;margin-bottom:4px;">${h.name}</div>
                  ${h.price ? `<div class="eb-text" style="font-size:0.8rem;color:${t.primary};font-weight:600;margin-bottom:8px;">${h.price}</div>` : ''}
                  ${h.address ? `<div style="font-size:0.82rem;color:${t.text};opacity:0.55;margin-bottom:10px;">&#128205; ${h.address}</div>` : ''}
                  ${h.note ? `<div class="eb-text" style="font-size:0.85rem;color:${t.text};opacity:0.7;font-style:italic;margin-bottom:14px;">${h.note}</div>` : ''}
                  ${h.bookingUrl ? `<a href="${h.bookingUrl}" target="_blank" style="display:inline-block;padding:9px 20px;background:${t.primary};color:white;border-radius:20px;text-decoration:none;font-size:0.82rem;font-weight:500;">Book Now &rarr;</a>` : ''}
                </div>
                ${h.address ? `<div style="min-height:200px;">
                  <iframe src="https://maps.google.com/maps?q=${encodeURIComponent(h.address)}&output=embed&z=15" width="100%" height="100%" style="border:0;display:block;min-height:200px;" allowfullscreen loading="lazy"></iframe>
                </div>` : ''}
              </div>`).join('')}
            </div>
          </div>
        </section>` : '';

        // Build nav links
        const navLinks = [
            '<a href="#story" onclick="event.preventDefault();document.getElementById(\'story\').scrollIntoView({behavior:\'smooth\'});">Our Story</a>',
            '<a href="#details" onclick="event.preventDefault();document.getElementById(\'details\').scrollIntoView({behavior:\'smooth\'});">Details</a>',
            validSchedule.length > 0 ? '<a href="#schedule" onclick="event.preventDefault();document.getElementById(\'schedule\').scrollIntoView({behavior:\'smooth\'});">Schedule</a>' : '',
            validParty.length > 0 ? '<a href="#party" onclick="event.preventDefault();document.getElementById(\'party\').scrollIntoView({behavior:\'smooth\'});">Wedding Party</a>' : '',
            data.photos && data.photos.length > 0 ? '<a href="#gallery" onclick="event.preventDefault();document.getElementById(\'gallery\').scrollIntoView({behavior:\'smooth\'});">Gallery</a>' : '',
            validHotels.length > 0 ? '<a href="#hotels" onclick="event.preventDefault();document.getElementById(\'hotels\').scrollIntoView({behavior:\'smooth\'});">Hotels</a>' : '',
            selectedRegistries.length > 0 ? '<a href="#registry" onclick="event.preventDefault();document.getElementById(\'registry\').scrollIntoView({behavior:\'smooth\'});">Registry</a>' : '',
        ].filter(Boolean).join('\n    ');

        return `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>${data.name1} &amp; ${data.name2}</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Jost:wght@300;400;500&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400&family=Raleway:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{font-family:${t.bodyFont};background:${t.bg};color:${t.text};}
nav{position:fixed;top:0;left:0;right:0;background:rgba(255,255,255,0.96);backdrop-filter:blur(10px);border-bottom:1px solid rgba(0,0,0,0.06);z-index:100;padding:0 30px;display:flex;align-items:center;justify-content:space-between;height:58px;}
.nav-names{font-family:${t.headFont};font-size:1.1rem;color:${t.primary};font-weight:400;white-space:nowrap;}
.nav-links{display:flex;gap:20px;overflow-x:auto;}
.nav-links a{text-decoration:none;font-size:0.75rem;letter-spacing:0.1em;text-transform:uppercase;color:${t.text};opacity:0.65;font-weight:500;transition:opacity 0.2s;white-space:nowrap;cursor:pointer;}
.nav-links a:hover{opacity:1;color:${t.primary};}
@keyframes floatDown{0%,100%{transform:translateY(0)}50%{transform:translateY(6px)}}
@media(max-width:600px){nav{padding:0 16px;}.nav-links{gap:12px;}}
</style>
</head>
<body>

<nav>
  <div class="nav-names">${data.name1} &amp; ${data.name2}</div>
  <div class="nav-links">
    ${navLinks}
  </div>
</nav>

<!-- HERO PHOTO BANNER -->
${data.heroPhoto ? `<div style="width:100%;height:55vh;min-height:300px;max-height:500px;overflow:hidden;position:relative;margin-top:58px;">
  <img src="${data.heroPhoto}" class="eb-photo" style="width:100%;height:100%;object-fit:cover;display:block;">
</div>` : ''}

<!-- NAMES & DATE -->
<section style="padding:${data.heroPhoto ? '60px' : '110px'} 30px 65px;background:${t.bg};text-align:center;position:relative;overflow:hidden;${!data.heroPhoto ? 'margin-top:58px;' : ''}">
  ${t.floral ? `
  <svg xmlns='http://www.w3.org/2000/svg' width='130' height='230' viewBox='0 0 130 230' style='position:absolute;left:0;bottom:0;opacity:0.14;pointer-events:none;' aria-hidden='true'>
    <g fill='${t.primary}'>
      <ellipse cx='38' cy='188' rx='22' ry='10' transform='rotate(-30 38 188)'/>
      <ellipse cx='22' cy='162' rx='17' ry='8' transform='rotate(-50 22 162)'/>
      <ellipse cx='58' cy='175' rx='19' ry='9' transform='rotate(-10 58 175)'/>
      <ellipse cx='28' cy='138' rx='14' ry='6' transform='rotate(-40 28 138)'/>
      <ellipse cx='62' cy='152' rx='16' ry='7' transform='rotate(10 62 152)'/>
      <ellipse cx='12' cy='115' rx='11' ry='5' transform='rotate(-60 12 115)'/>
      <circle cx='40' cy='194' r='6' fill='${t.accent}' opacity='0.8'/>
      <circle cx='24' cy='168' r='5' fill='${t.accent}' opacity='0.7'/>
      <circle cx='60' cy='181' r='5' fill='${t.accent}' opacity='0.7'/>
      <line x1='40' y1='198' x2='40' y2='95' stroke='${t.primary}' stroke-width='1.5' opacity='0.3'/>
      <line x1='40' y1='162' x2='22' y2='144' stroke='${t.primary}' stroke-width='1' opacity='0.25'/>
      <line x1='40' y1='175' x2='60' y2='157' stroke='${t.primary}' stroke-width='1' opacity='0.25'/>
      <line x1='40' y1='142' x2='12' y2='122' stroke='${t.primary}' stroke-width='1' opacity='0.2'/>
    </g>
  </svg>
  <svg xmlns='http://www.w3.org/2000/svg' width='130' height='230' viewBox='0 0 130 230' style='position:absolute;right:0;bottom:0;opacity:0.14;pointer-events:none;transform:scaleX(-1);' aria-hidden='true'>
    <g fill='${t.primary}'>
      <ellipse cx='38' cy='188' rx='22' ry='10' transform='rotate(-30 38 188)'/>
      <ellipse cx='22' cy='162' rx='17' ry='8' transform='rotate(-50 22 162)'/>
      <ellipse cx='58' cy='175' rx='19' ry='9' transform='rotate(-10 58 175)'/>
      <ellipse cx='28' cy='138' rx='14' ry='6' transform='rotate(-40 28 138)'/>
      <ellipse cx='62' cy='152' rx='16' ry='7' transform='rotate(10 62 152)'/>
      <ellipse cx='12' cy='115' rx='11' ry='5' transform='rotate(-60 12 115)'/>
      <circle cx='40' cy='194' r='6' fill='${t.accent}' opacity='0.8'/>
      <circle cx='24' cy='168' r='5' fill='${t.accent}' opacity='0.7'/>
      <circle cx='60' cy='181' r='5' fill='${t.accent}' opacity='0.7'/>
      <line x1='40' y1='198' x2='40' y2='95' stroke='${t.primary}' stroke-width='1.5' opacity='0.3'/>
      <line x1='40' y1='162' x2='22' y2='144' stroke='${t.primary}' stroke-width='1' opacity='0.25'/>
      <line x1='40' y1='175' x2='60' y2='157' stroke='${t.primary}' stroke-width='1' opacity='0.25'/>
      <line x1='40' y1='142' x2='12' y2='122' stroke='${t.primary}' stroke-width='1' opacity='0.2'/>
    </g>
  </svg>` : ''}
  <div style="position:relative;z-index:1;">
    <div style="font-family:${t.headFont};font-size:clamp(2.6rem,6vw,4.8rem);font-weight:300;line-height:1.1;color:${t.text};margin-bottom:22px;letter-spacing:0.02em;">
      <span class="eb-text">${data.name1}</span>
      <div style="font-family:${t.headFont};font-style:italic;color:${t.primary};font-size:0.42em;margin:10px 0;letter-spacing:0.12em;font-weight:300;">and</div>
      <span class="eb-text">${data.name2}</span>
    </div>
    ${fDate ? `<div style="display:flex;align-items:center;justify-content:center;gap:14px;">
      <span style="display:block;width:36px;height:1px;background:${t.primary};opacity:0.35;"></span>
      <div class="eb-text" style="font-size:0.8rem;letter-spacing:0.2em;text-transform:uppercase;color:${t.text};opacity:0.55;font-weight:400;">${fDate}</div>
      <span style="display:block;width:36px;height:1px;background:${t.primary};opacity:0.35;"></span>
    </div>` : ''}
  </div>
</section>

<!-- OUR STORY -->
<section id="story" style="padding:80px 20px;background:${t.light};">
  <div style="max-width:700px;margin:0 auto;">
    <div style="text-align:center;margin-bottom:40px;">
      <h2 style="font-family:${t.headFont};font-size:clamp(1.8rem,4vw,2.6rem);font-weight:300;color:${t.text};line-height:1.2;">Our Story</h2>
    </div>
    <div style="font-size:1.05rem;line-height:1.9;color:${t.text};font-weight:300;">
      ${storyCopy}
    </div>
  </div>
</section>

<!-- DETAILS -->
<section id="details" style="padding:80px 20px;background:${t.light};position:relative;">
  ${t.floral ? `<div style="position:absolute;top:10px;left:30px;font-size:3rem;opacity:0.07;pointer-events:none;">üå∑</div>` : ''}
  <div style="max-width:800px;margin:0 auto;text-align:center;position:relative;z-index:1;">
    
    <h2 style="font-family:${t.headFont};font-size:clamp(1.8rem,4vw,2.8rem);font-weight:300;color:${t.text};margin-bottom:36px;line-height:1.2;">Wedding Details</h2>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;text-align:center;margin-bottom:${ceremonyAddr ? '40px' : '0'};">
      ${fDate ? `<div style="background:white;border-radius:14px;padding:22px 16px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 2px 12px rgba(0,0,0,0.04);"><div style="font-size:1.5rem;margin-bottom:8px;">&#128197;</div><div style="font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;color:${t.accent};font-weight:600;margin-bottom:5px;">Date</div><div class="eb-text" style="font-size:0.88rem;color:${t.text};line-height:1.5;">${fDate}</div></div>` : ''}
      <div style="background:white;border-radius:14px;padding:22px 16px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 2px 12px rgba(0,0,0,0.04);"><div style="font-size:1.5rem;margin-bottom:8px;">&#128146;</div><div style="font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;color:${t.accent};font-weight:600;margin-bottom:5px;">Ceremony</div><div class="eb-text" style="font-size:0.88rem;color:${t.text};line-height:1.5;">${data.ceremonyLocation || 'TBA'}${fTime ? '<br>' + fTime : ''}</div></div>
      <div style="background:white;border-radius:14px;padding:22px 16px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 2px 12px rgba(0,0,0,0.04);"><div style="font-size:1.5rem;margin-bottom:8px;">&#127942;</div><div style="font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;color:${t.accent};font-weight:600;margin-bottom:5px;">Reception</div><div class="eb-text" style="font-size:0.88rem;color:${t.text};line-height:1.5;">${reception || 'TBA'}</div></div>
      ${data.dressCode ? `<div style="background:white;border-radius:14px;padding:22px 16px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 2px 12px rgba(0,0,0,0.04);"><div style="font-size:1.5rem;margin-bottom:8px;">&#128507;</div><div style="font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;color:${t.accent};font-weight:600;margin-bottom:5px;">Dress Code</div><div class="eb-text" style="font-size:0.88rem;color:${t.text};line-height:1.5;">${data.dressCode}</div></div>` : ''}
    </div>
    ${ceremonyAddr ? `
    <div style="display:grid;grid-template-columns:${hasDualMap ? '1fr 1fr' : '1fr'};gap:24px;text-align:left;">
      <div>
        <div style="font-weight:600;color:${t.text};margin-bottom:6px;font-size:0.9rem;">&#128146; Ceremony Location</div>
        <div style="font-size:0.85rem;color:${t.text};opacity:0.6;margin-bottom:10px;">${ceremonyAddr}</div>
        <div style="border-radius:12px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.08);">
          <iframe src="https://maps.google.com/maps?q=${encodeURIComponent(ceremonyAddr)}&output=embed&z=15" width="100%" height="260" style="border:0;display:block;" allowfullscreen loading="lazy"></iframe>
        </div>
      </div>
      ${hasDualMap ? `
      <div>
        <div style="font-weight:600;color:${t.text};margin-bottom:6px;font-size:0.9rem;">&#127942; Reception Venue</div>
        <div style="font-size:0.85rem;color:${t.text};opacity:0.6;margin-bottom:10px;">${receptionAddr}</div>
        <div style="border-radius:12px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.08);">
          <iframe src="https://maps.google.com/maps?q=${encodeURIComponent(receptionAddr)}&output=embed&z=15" width="100%" height="260" style="border:0;display:block;" allowfullscreen loading="lazy"></iframe>
        </div>
      </div>` : ''}
    </div>` : ''}
  </div>
</section>

${scheduleSection}
${partySection}
${gallerySection}
${mapSection}
${registrySection}

${(data.selectedResources && data.selectedResources.length > 0) ? `
<section style="padding:60px 20px;background:${t.bg};border-top:1px solid rgba(0,0,0,0.05);">
  <div style="max-width:700px;margin:0 auto;text-align:center;">
    <p style="font-size:0.7rem;letter-spacing:0.15em;text-transform:uppercase;color:${t.primary};font-weight:600;margin-bottom:12px;">Still Planning?</p>
    <h2 style="font-family:${t.headFont};font-size:clamp(1.4rem,3vw,2rem);font-weight:300;color:${t.text};margin-bottom:24px;">Wedding Resources We Love</h2>
    <div style="display:flex;flex-wrap:wrap;gap:12px;justify-content:center;">
      ${data.selectedResources.includes('dresses') ? `<a href="https://www.elegantbrideco.com/wedding-dresses" target="_blank" style="display:inline-flex;align-items:center;gap:8px;padding:12px 22px;border:1.5px solid ${t.primary};border-radius:50px;color:${t.primary};text-decoration:none;font-size:0.85rem;font-weight:500;transition:all 0.2s;">üëó Wedding Dresses</a>` : ''}
      ${data.selectedResources.includes('invitations') ? `<a href="https://www.elegantbrideco.com/wedding-invitations" target="_blank" style="display:inline-flex;align-items:center;gap:8px;padding:12px 22px;border:1.5px solid ${t.primary};border-radius:50px;color:${t.primary};text-decoration:none;font-size:0.85rem;font-weight:500;transition:all 0.2s;">üíå Invitations</a>` : ''}
      ${data.selectedResources.includes('decorations') ? `<a href="https://www.elegantbrideco.com/wedding-decorations" target="_blank" style="display:inline-flex;align-items:center;gap:8px;padding:12px 22px;border:1.5px solid ${t.primary};border-radius:50px;color:${t.primary};text-decoration:none;font-size:0.85rem;font-weight:500;transition:all 0.2s;">üå∏ Decorations</a>` : ''}
      ${data.selectedResources.includes('planner') ? `<a href="https://www.elegantbrideco.com/wedding-planner" target="_blank" style="display:inline-flex;align-items:center;gap:8px;padding:12px 22px;background:${t.primary};border-radius:50px;color:white;text-decoration:none;font-size:0.85rem;font-weight:500;">üìã Free Wedding Planner App</a>` : ''}
    </div>
    <p style="font-size:0.72rem;color:${t.text};opacity:0.35;margin-top:18px;">Curated by Elegant Bride Co.</p>
  </div>
</section>` : ''}
<footer style="background:${t.text};color:white;text-align:center;padding:50px 20px;">
  <div style="font-family:${t.headFont};font-size:2rem;font-weight:300;margin-bottom:8px;opacity:0.9;">${data.name1} &amp; ${data.name2}</div>
  ${fDate ? `<div style="font-size:0.85rem;opacity:0.4;letter-spacing:0.1em;margin-bottom:20px;">${fDate}</div>` : ''}
  <div style="font-size:0.72rem;opacity:0.25;letter-spacing:0.08em;">Website created with <a href="https://www.elegantbrideco.com" target="_blank" style="color:white;">Elegant Bride Co.</a></div>
</footer>


</body></html>`;
    }

</script>
</body>
</html>