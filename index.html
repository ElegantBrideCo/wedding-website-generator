<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Wedding Website Generator ‚Äî Elegant Bride Co.</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --sage: #A8B89C; --sage-dark: #8FA98F;
            --blush: #D4A5A5; --blush-light: #F0E0E0;
            --cream: #F8F6F3; --warm-gray: #E8E4DF;
            --text: #4A4540; --text-light: #8A837C; --border: #D8D0C8;
        }
        body { font-family: 'Jost', sans-serif; background: var(--cream); color: var(--text); min-height: 100vh; }

        .site-header { background: white; border-bottom: 1px solid var(--border); padding: 18px 40px; display: flex; align-items: center; justify-content: space-between; }
        .site-header .brand { font-family: 'Cormorant Garamond', serif; font-size: 1.4rem; color: var(--blush); letter-spacing: 0.05em; text-decoration: none; }
        .site-header .tagline { font-size: 0.8rem; color: var(--text-light); letter-spacing: 0.08em; text-transform: uppercase; }

        .hero { background: white; text-align: center; padding: 60px 20px 50px; border-bottom: 1px solid var(--border); position: relative; overflow: hidden; }
        .hero::before { content: ''; position: absolute; top: -60px; left: -60px; width: 300px; height: 300px; background: radial-gradient(circle, var(--blush-light) 0%, transparent 70%); opacity: 0.5; }
        .hero::after { content: ''; position: absolute; bottom: -80px; right: -40px; width: 350px; height: 350px; background: radial-gradient(circle, #E8F0E4 0%, transparent 70%); opacity: 0.6; }
        .hero-inner { position: relative; z-index: 1; }
        .hero-eyebrow { font-size: 0.75rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--sage); font-weight: 500; margin-bottom: 14px; }
        .hero h1 { font-family: 'Cormorant Garamond', serif; font-size: clamp(2.4rem, 5vw, 3.8rem); font-weight: 300; color: var(--text); line-height: 1.15; margin-bottom: 16px; }
        .hero h1 em { color: var(--blush); font-style: italic; }
        .hero p { font-size: 1.05rem; color: var(--text-light); max-width: 560px; margin: 0 auto; line-height: 1.7; font-weight: 300; }

        .main-wrap { max-width: 900px; margin: 0 auto; padding: 50px 20px 80px; }

        .steps { display: flex; align-items: center; justify-content: center; margin-bottom: 44px; }
        .step { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; font-weight: 500; letter-spacing: 0.06em; text-transform: uppercase; color: var(--text-light); }
        .step.active { color: var(--blush); }
        .step.done { color: var(--sage); }
        .step-num { width: 28px; height: 28px; border-radius: 50%; border: 2px solid currentColor; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 600; flex-shrink: 0; }
        .step.done .step-num { background: var(--sage); color: white; border-color: var(--sage); }
        .step.active .step-num { background: var(--blush); color: white; border-color: var(--blush); }
        .step-line { width: 40px; height: 1px; background: var(--border); margin: 0 8px; }

        .form-card { background: white; border-radius: 16px; border: 1px solid var(--border); overflow: hidden; box-shadow: 0 4px 24px rgba(0,0,0,0.04); }
        .form-section { padding: 32px 40px; border-bottom: 1px solid var(--warm-gray); }
        .form-section:last-of-type { border-bottom: none; }
        .section-label { font-size: 0.7rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--sage); font-weight: 600; margin-bottom: 6px; }
        .section-title { font-family: 'Cormorant Garamond', serif; font-size: 1.5rem; font-weight: 400; color: var(--text); margin-bottom: 20px; }
        .section-desc { color: var(--text-light); font-size: 0.88rem; line-height: 1.6; margin-bottom: 18px; margin-top: -10px; }

        .field-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .field-grid.full { grid-template-columns: 1fr; }
        .field-grid.thirds { grid-template-columns: 1fr 1fr 1fr; }
        @media (max-width: 640px) { .field-grid, .field-grid.thirds { grid-template-columns: 1fr; } .form-section { padding: 24px 20px; } }

        .field { display: flex; flex-direction: column; gap: 6px; }
        .field label { font-size: 0.8rem; font-weight: 500; color: var(--text); letter-spacing: 0.02em; }
        .field label .hint { font-weight: 300; color: var(--text-light); font-size: 0.75rem; }
        .field input, .field textarea, .field select { border: 1.5px solid var(--border); border-radius: 8px; padding: 11px 14px; font-family: 'Jost', sans-serif; font-size: 0.95rem; color: var(--text); background: white; transition: border-color 0.2s; width: 100%; }
        .field input:focus, .field textarea:focus, .field select:focus { outline: none; border-color: var(--blush); }
        .field textarea { resize: vertical; min-height: 90px; line-height: 1.6; }

        /* Photo upload */
        .photo-upload-area { border: 2px dashed var(--border); border-radius: 12px; padding: 28px 20px; text-align: center; cursor: pointer; transition: all 0.2s; background: var(--cream); position: relative; }
        .photo-upload-area:hover { border-color: var(--blush); background: white; }
        .photo-upload-area input[type=file] { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }
        .photo-upload-area .upload-icon { font-size: 2rem; margin-bottom: 8px; }
        .photo-upload-area .upload-text { font-size: 0.9rem; color: var(--text-light); }
        .photo-upload-area .upload-hint { font-size: 0.75rem; color: var(--border); margin-top: 4px; }
        .photo-preview-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-top: 14px; }
        .photo-thumb { position: relative; aspect-ratio: 1; border-radius: 8px; overflow: hidden; }
        .photo-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .photo-thumb .remove-photo { position: absolute; top: 4px; right: 4px; background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 0.7rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* Wedding party */
        .party-member { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end; padding: 12px; background: var(--cream); border-radius: 8px; margin-bottom: 10px; }
        @media (max-width: 640px) { .party-member { grid-template-columns: 1fr 1fr; } }
        .add-btn { display: flex; align-items: center; gap: 6px; padding: 10px 16px; background: white; border: 2px dashed var(--border); border-radius: 8px; color: var(--blush); font-family: 'Jost', sans-serif; font-size: 0.85rem; font-weight: 500; cursor: pointer; transition: all 0.2s; width: 100%; justify-content: center; margin-top: 8px; }
        .add-btn:hover { border-color: var(--blush); background: var(--blush-light); }
        .remove-btn { background: none; border: none; color: var(--text-light); cursor: pointer; font-size: 1.1rem; padding: 8px; transition: color 0.2s; }
        .remove-btn:hover { color: var(--blush); }

        /* Schedule */
        .schedule-item { display: grid; grid-template-columns: 120px 1fr auto; gap: 10px; align-items: end; padding: 12px; background: var(--cream); border-radius: 8px; margin-bottom: 10px; }
        @media (max-width: 640px) { .schedule-item { grid-template-columns: 1fr 1fr; } }

        /* Registry */
        .registry-preset-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .registry-preset { display: none; }
        .registry-preset-label { border: 2px solid var(--border); border-radius: 10px; padding: 14px 10px; text-align: center; cursor: pointer; transition: all 0.2s; background: var(--cream); }
        .registry-preset-label:hover { border-color: var(--blush); background: white; }
        .registry-preset:checked + .registry-preset-label { border-color: var(--sage); background: white; box-shadow: 0 0 0 3px rgba(168,184,156,0.2); }
        .registry-preset-label .reg-icon { font-size: 1.4rem; margin-bottom: 6px; }
        .registry-preset-label .reg-name { font-size: 0.78rem; font-weight: 600; color: var(--text); display: block; }
        .registry-preset-label .reg-badge { font-size: 0.65rem; color: var(--sage); font-weight: 600; letter-spacing: 0.05em; text-transform: uppercase; display: block; margin-top: 2px; }
        .custom-registry { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 6px; }

        /* Tone picker */
        .tone-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 4px; }
        @media (max-width: 600px) { .tone-grid { grid-template-columns: 1fr 1fr; } }
        .tone-option { display: none; }
        .tone-label { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 16px 8px 14px; border: 2px solid var(--border); border-radius: 12px; cursor: pointer; transition: all 0.2s; text-align: center; background: var(--cream); }
        .tone-label:hover { border-color: var(--blush); background: white; }
        .tone-option:checked + .tone-label { border-color: var(--blush); background: white; box-shadow: 0 0 0 3px var(--blush-light); }
        .tone-emoji { font-size: 1.6rem; line-height: 1; }
        .tone-name { font-size: 0.78rem; font-weight: 600; color: var(--text); letter-spacing: 0.03em; }
        .tone-desc { font-size: 0.7rem; color: var(--text-light); line-height: 1.4; }

        /* Theme */
        .theme-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .theme-option { position: absolute; opacity: 0; width: 0; height: 0; pointer-events: none; }
        .theme-label { border: 2px solid var(--border); border-radius: 12px; overflow: hidden; cursor: pointer; transition: all 0.2s; display: block; height: 100%; }
        .theme-label:hover { border-color: var(--blush); }
        .theme-label:has(.theme-option:checked) { border-color: var(--blush); box-shadow: 0 0 0 3px var(--blush-light); }
        .theme-swatch { height: 70px; display: flex; }
        .theme-swatch span { flex: 1; display: block; }
        .theme-info { padding: 10px 12px; background: white; }
        .theme-info strong { font-size: 0.82rem; display: block; color: var(--text); }
        .theme-info small { font-size: 0.72rem; color: var(--text-light); }

        /* Generate */
        .generate-wrap { padding: 36px 40px; text-align: center; background: var(--cream); border-top: 1px solid var(--warm-gray); }
        .btn-generate { background: var(--blush); color: white; border: none; padding: 16px 48px; border-radius: 50px; font-family: 'Jost', sans-serif; font-size: 1rem; font-weight: 500; letter-spacing: 0.06em; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 10px; }
        .btn-generate:hover { background: #C49090; transform: translateY(-1px); box-shadow: 0 6px 20px rgba(212,165,165,0.4); }
        .generate-note { font-size: 0.8rem; color: var(--text-light); margin-top: 12px; }

        /* Loading */
        .loading-state { display: none; text-align: center; padding: 60px 40px; }
        .loading-state.visible { display: block; }
        .loading-rings { display: flex; align-items: center; justify-content: center; gap: 6px; margin-bottom: 24px; }
        .ring { width: 12px; height: 12px; border-radius: 50%; background: var(--blush); animation: pulse 1.4s ease-in-out infinite; }
        .ring:nth-child(2) { animation-delay: 0.2s; background: var(--sage); }
        .ring:nth-child(3) { animation-delay: 0.4s; background: var(--blush); }
        @keyframes pulse { 0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; } 40% { transform: scale(1); opacity: 1; } }
        .loading-title { font-family: 'Cormorant Garamond', serif; font-size: 1.6rem; color: var(--text); margin-bottom: 8px; }
        .loading-sub { color: var(--text-light); font-size: 0.9rem; }

        /* Result */
        #resultSection { display: none; }
        #resultSection.visible { display: block; }
        .result-actions { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-bottom: 32px; }
        .btn-action { padding: 12px 28px; border-radius: 50px; font-family: 'Jost', sans-serif; font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: all 0.2s; letter-spacing: 0.04em; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--blush); color: white; border: none; }
        .btn-primary:hover { background: #C49090; }
        .btn-secondary { background: white; color: var(--text); border: 2px solid var(--border); }
        .btn-secondary:hover { border-color: var(--sage); }
        .btn-sage { background: var(--sage); color: white; border: none; }
        .btn-sage:hover { background: var(--sage-dark); }

        .preview-frame-wrap { border: 1px solid var(--border); border-radius: 16px; overflow: hidden; box-shadow: 0 8px 40px rgba(0,0,0,0.08); }
        .preview-bar { background: #F0EDE8; padding: 10px 16px; display: flex; align-items: center; gap: 8px; border-bottom: 1px solid var(--border); }
        .dot { width: 10px; height: 10px; border-radius: 50%; }
        .dot-r { background: #FF6058; } .dot-y { background: #FFBD2E; } .dot-g { background: #28C840; }
        .url-bar { flex: 1; background: white; border-radius: 20px; padding: 4px 14px; font-size: 0.75rem; color: var(--text-light); }
        iframe#previewFrame { width: 100%; height: 750px; border: none; display: block; }

        /* Affiliate banner */
        .affiliate-banner { margin-top: 40px; background: white; border: 1px solid var(--border); border-radius: 16px; padding: 32px 36px; }
        .affiliate-banner h3 { font-family: 'Cormorant Garamond', serif; font-size: 1.4rem; margin-bottom: 6px; color: var(--text); }
        .affiliate-banner p { color: var(--text-light); font-size: 0.9rem; margin-bottom: 20px; line-height: 1.6; }
        .affiliate-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; }
        .affiliate-card { border: 1.5px solid var(--border); border-radius: 10px; padding: 16px; text-align: center; text-decoration: none; transition: all 0.2s; background: var(--cream); }
        .affiliate-card:hover { border-color: var(--blush); background: white; transform: translateY(-2px); }
        .affiliate-card.featured { border-color: var(--sage); background: white; position: relative; }
        .affiliate-card.featured::before { content: '‚òÖ Top Pick'; position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--sage); color: white; font-size: 0.65rem; font-weight: 600; padding: 2px 10px; border-radius: 20px; letter-spacing: 0.05em; white-space: nowrap; }
        .aff-icon { font-size: 1.6rem; margin-bottom: 6px; }
        .aff-name { font-size: 0.82rem; font-weight: 600; color: var(--text); }
        .aff-desc { font-size: 0.72rem; color: var(--text-light); margin-top: 2px; }

        .site-footer { text-align: center; padding: 40px 20px; border-top: 1px solid var(--border); font-size: 0.8rem; color: var(--text-light); background: white; margin-top: 60px; }
        .site-footer a { color: var(--blush); text-decoration: none; }
    </style>
</head>
<body>

<header class="site-header">
    <a href="https://www.elegantbrideco.com" class="brand">Elegant Bride Co.</a>
    <span class="tagline">Free Wedding Tools</span>
</header>

<div class="hero">
    <div class="hero-inner">
        <div class="hero-eyebrow">&#10022; Free Wedding Tool</div>
        <h1>Your Wedding Website,<br><em>Written &amp; Built for You</em></h1>
        <p>Fill in the details, choose your style, and we'll create a beautiful personalized wedding website ‚Äî complete with AI-written copy, photo gallery, schedule, registry &amp; more.</p>
    </div>
</div>

<div class="main-wrap">

    <div class="steps">
        <div class="step active" id="step1indicator"><div class="step-num">1</div><span>Details</span></div>
        <div class="step-line"></div>
        <div class="step" id="step2indicator"><div class="step-num">2</div><span>Story &amp; Style</span></div>
        <div class="step-line"></div>
        <div class="step" id="step3indicator"><div class="step-num">3</div><span>Your Website</span></div>
    </div>

    <div class="form-card" id="formSection">

        <!-- SECTION 1: THE COUPLE -->
        <div class="form-section">
            <div class="section-label">Section 01</div>
            <div class="section-title">The Happy Couple</div>
            <div class="field-grid">
                <div class="field"><label>Your Name <span class="hint">(Partner 1)</span></label><input type="text" id="name1" placeholder="e.g. Sarah"></div>
                <div class="field"><label>Their Name <span class="hint">(Partner 2)</span></label><input type="text" id="name2" placeholder="e.g. James"></div>
            </div>
            <div style="margin-top:16px;">
                <label style="font-size:0.82rem;font-weight:500;color:var(--text);display:block;margin-bottom:8px;">Couple Photo <span style="font-weight:300;color:var(--text-light);">(optional ‚Äî displays as a banner at the top of your website)</span></label>
                <div style="display:flex;align-items:center;gap:16px;">
                    <div id="heroPhotoPreview" style="width:90px;height:90px;border-radius:12px;border:2px dashed var(--border);overflow:hidden;cursor:pointer;background:white;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:4px;flex-shrink:0;" onclick="document.getElementById('heroPhotoInput').click()">
                        <span style="font-size:1.6rem;">üì∑</span>
                        <span style="font-size:0.62rem;color:var(--text-light);text-align:center;line-height:1.3;">Add<br>Photo</span>
                    </div>
                    <div style="font-size:0.8rem;color:var(--text-light);line-height:1.6;">A beautiful photo of you two will appear as a full-width banner behind your names. Landscape photos work best.</div>
                </div>
                <input type="file" id="heroPhotoInput" accept="image/*" style="display:none" onchange="handleHeroPhoto(event)">
                <div id="heroRemoveBtn" style="display:none;margin-top:8px;"><button onclick="heroPhoto='';document.getElementById('heroPhotoPreview').innerHTML='<span style=\\'font-size:1.6rem;\\'>üì∑</span><span style=\\'font-size:0.62rem;color:var(--text-light);text-align:center;\\'>Add Photo</span>';document.getElementById('heroRemoveBtn').style.display='none';" style="font-size:0.75rem;color:var(--text-light);background:none;border:none;cursor:pointer;text-decoration:underline;">‚úï Remove photo</button></div>
            </div>
        </div>

        <!-- SECTION 2: PHOTOS -->
        <div class="form-section">
            <div class="section-label">Section 02</div>
            <div class="section-title">Your Photos <span style="font-family:'Jost',sans-serif;font-size:0.9rem;font-weight:300;color:var(--text-light);">(optional)</span></div>
            <p class="section-desc">Add photos of you two ‚Äî engagement photos, proposal moment, or just your favorites. They'll appear in a beautiful gallery on your website.</p>
            <div class="photo-upload-area" id="photoUploadArea" onclick="document.getElementById('photoInput').click()">
                <input type="file" id="photoInput" accept="image/*" multiple style="display:none" onchange="handlePhotoUpload(event)">
                <div class="upload-icon">&#128247;</div>
                <div class="upload-text">Click to upload photos</div>
                <div class="upload-hint">JPG, PNG ¬∑ Up to 5 photos ¬∑ Max 5MB each</div>
            </div>
            <div class="photo-preview-grid" id="photoPreviewGrid"></div>
        </div>

        <!-- SECTION 3: THE BIG DAY -->
        <div class="form-section">
            <div class="section-label">Section 03</div>
            <div class="section-title">The Big Day</div>
            <div class="field-grid">
                <div class="field"><label>Wedding Date</label><input type="date" id="weddingDate"></div>
                <div class="field"><label>Ceremony Venue <span class="hint">(name &amp; city)</span></label><input type="text" id="ceremonyLocation" placeholder="e.g. Riverside Gardens, Austin TX"></div>
                <div class="field"><label>Ceremony Time</label><input type="time" id="ceremonyTime"></div>
                <div class="field"><label>Ceremony Address <span class="hint">(for map)</span></label><input type="text" id="ceremonyAddress" placeholder="e.g. 123 River Rd, Austin TX 78701"></div>
                <div class="field"><label>Reception Venue <span class="hint">(leave blank if same)</span></label><input type="text" id="receptionLocation" placeholder="Same as ceremony"></div>
                <div class="field"><label>Reception Address <span class="hint">(if different)</span></label><input type="text" id="receptionAddress" placeholder="Leave blank if same as ceremony"></div>
                <div class="field"><label>Dress Code</label>
                    <select id="dressCode">
                        <option value="">Select dress code...</option>
                        <option>Black Tie</option><option>Formal</option><option>Cocktail Attire</option>
                        <option>Semi-Formal</option><option>Garden Party</option><option>Casual Chic</option>
                        <option>Casual</option><option>Outdoor / Come Comfortable</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- SECTION 3b: ACCOMMODATIONS -->
        <div class="form-section">
            <div class="section-label">Section 03b</div>
            <div class="section-title">Accommodations <span style="font-family:'Jost',sans-serif;font-size:0.9rem;font-weight:300;color:var(--text-light);">(optional)</span></div>
            <p class="section-desc">Add recommended hotels or lodging options for guests. Include a booking link so they can reserve easily.</p>
            <div id="hotelItems"></div>
            <button class="add-btn" onclick="addHotel()">+ Add Hotel</button>
            <div style="display:none">
            </div>
        </div>

        <!-- SECTION 4: SCHEDULE -->
        <div class="form-section">
            <div class="section-label">Section 04</div>
            <div class="section-title">Day-of Schedule <span style="font-family:'Jost',sans-serif;font-size:0.9rem;font-weight:300;color:var(--text-light);">(optional)</span></div>
            <p class="section-desc">Give guests a timeline for the day so they know what to expect.</p>
            <div id="scheduleItems"></div>
            <button class="add-btn" onclick="addScheduleItem()">+ Add Event</button>
        </div>

        <!-- SECTION 5: WEDDING PARTY -->
        <div class="form-section">
            <div class="section-label">Section 05</div>
            <div class="section-title">Wedding Party <span style="font-family:'Jost',sans-serif;font-size:0.9rem;font-weight:300;color:var(--text-light);">(optional)</span></div>
            <p class="section-desc">Introduce your wedding party! Add a note about each person and choose a tone ‚Äî our AI will write them a fun personalized blurb.</p>
            <div id="partyMembers"></div>
            <button class="add-btn" onclick="addPartyMember()">+ Add Member</button>
        </div>

        <!-- SECTION 6: REGISTRY -->
        <div class="form-section">
            <div class="section-label">Section 06</div>
            <div class="section-title">Registry <span style="font-family:'Jost',sans-serif;font-size:0.9rem;font-weight:300;color:var(--text-light);">(optional)</span></div>
            <p class="section-desc">Which registries would you like to include on your website?</p>
            <div style="display:flex;flex-direction:column;gap:12px;">
                <label style="display:flex;align-items:center;gap:14px;padding:16px 20px;border:2px solid var(--border);border-radius:12px;cursor:pointer;transition:all 0.2s;background:var(--cream);" id="reg-amazon-wrap">
                    <input type="checkbox" id="reg-amazon" name="registry" value="amazon" onchange="updateRegStyle('amazon',this.checked)" style="width:18px;height:18px;accent-color:var(--sage);cursor:pointer;flex-shrink:0;">
                    <div style="flex:1;">
                        <div style="display:flex;align-items:center;gap:8px;">
                            <span style="font-weight:600;color:var(--text);font-size:0.95rem;">Amazon Registry</span>
                            <span style="background:var(--sage);color:white;font-size:0.62rem;font-weight:700;padding:2px 8px;border-radius:20px;letter-spacing:0.06em;text-transform:uppercase;">‚òÖ Recommended</span>
                        </div>
                        <div style="font-size:0.8rem;color:var(--text-light);margin-top:2px;">Largest selection, easy for guests, fast shipping</div>
                    </div>
                </label>
                <label style="display:flex;align-items:center;gap:14px;padding:16px 20px;border:2px solid var(--border);border-radius:12px;cursor:pointer;transition:all 0.2s;background:var(--cream);" id="reg-honeyfund-wrap">
                    <input type="checkbox" id="reg-honeyfund" name="registry" value="honeyfund" onchange="updateRegStyle('honeyfund',this.checked)" style="width:18px;height:18px;accent-color:var(--sage);cursor:pointer;flex-shrink:0;">
                    <div style="flex:1;">
                        <div style="font-weight:600;color:var(--text);font-size:0.95rem;">Honeyfund</div>
                        <div style="font-size:0.8rem;color:var(--text-light);margin-top:2px;">Let guests contribute to your honeymoon or experiences</div>
                    </div>
                </label>
                <label style="display:flex;align-items:center;gap:14px;padding:16px 20px;border:2px solid var(--border);border-radius:12px;cursor:pointer;transition:all 0.2s;background:var(--cream);" id="reg-custom-wrap">
                    <input type="checkbox" id="reg-custom" name="registry" value="custom" onchange="updateRegStyle('custom',this.checked);document.getElementById('customRegistryFields').style.display=this.checked?'block':'none';" style="width:18px;height:18px;accent-color:var(--sage);cursor:pointer;flex-shrink:0;">
                    <div style="flex:1;">
                        <div style="font-weight:600;color:var(--text);font-size:0.95rem;">Other Registry</div>
                        <div style="font-size:0.8rem;color:var(--text-light);margin-top:2px;">Target, Walmart, Crate &amp; Barrel, etc.</div>
                    </div>
                </label>
            </div>
            <div id="customRegistryFields" style="display:none;margin-top:14px;">
                <div class="field-grid">
                    <div class="field"><label>Registry Name</label><input type="text" id="customRegName" placeholder="e.g. Target"></div>
                    <div class="field"><label>Registry URL</label><input type="url" id="customRegUrl" placeholder="https://..."></div>
                </div>
            </div>
        </div>

        <!-- SECTION 7: YOUR STORY -->
        <div class="form-section">
            <div class="section-label">Section 07</div>
            <div class="section-title">Your Story</div>
            <div class="field-grid full" style="gap:16px;">
                <div class="field"><label>How did you meet? <span class="hint">(a sentence or two is fine)</span></label><textarea id="howMet" placeholder="e.g. We met at a mutual friend's birthday party in 2019..."></textarea></div>
                <div class="field"><label>The Proposal <span class="hint">(how did it happen?)</span></label><textarea id="proposal" placeholder="e.g. He proposed at sunrise on the beach..."></textarea></div>
                <div class="field"><label>Anything else you'd like guests to know? <span class="hint">(optional)</span></label><textarea id="extraDetails" placeholder="e.g. Our dog Biscuit will be the ring bearer!" style="min-height:70px;"></textarea></div>
            </div>
        </div>

        <!-- SECTION 8: TONE -->
        <div class="form-section">
            <div class="section-label">Section 08</div>
            <div class="section-title">Story Tone</div>
            <p class="section-desc">How should we write your "Our Story" section?</p>
            <div class="tone-grid">
                <div><input type="radio" name="tone" id="tone-romantic" value="romantic" class="tone-option" checked><label for="tone-romantic" class="tone-label"><span class="tone-emoji">&#128149;</span><span class="tone-name">Romantic</span><span class="tone-desc">Warm, heartfelt &amp; poetic</span></label></div>
                <div><input type="radio" name="tone" id="tone-humorous" value="humorous" class="tone-option"><label for="tone-humorous" class="tone-label"><span class="tone-emoji">&#128516;</span><span class="tone-name">Humorous</span><span class="tone-desc">Funny &amp; lighthearted</span></label></div>
                <div><input type="radio" name="tone" id="tone-modern" value="modern" class="tone-option"><label for="tone-modern" class="tone-label"><span class="tone-emoji">&#10024;</span><span class="tone-name">Modern</span><span class="tone-desc">Clean, simple, no fluff</span></label></div>
                <div><input type="radio" name="tone" id="tone-whimsical" value="whimsical" class="tone-option"><label for="tone-whimsical" class="tone-label"><span class="tone-emoji">&#127807;</span><span class="tone-name">Whimsical</span><span class="tone-desc">Dreamy &amp; fairytale-ish</span></label></div>
                <div><input type="radio" name="tone" id="tone-classic" value="classic" class="tone-option"><label for="tone-classic" class="tone-label"><span class="tone-emoji">&#129392;</span><span class="tone-name">Classic</span><span class="tone-desc">Timeless &amp; elegant</span></label></div>
            </div>
        </div>

        <!-- SECTION 9: THEME -->
        <div class="form-section">
            <div class="section-label">Section 09</div>
            <div class="section-title">Color Theme</div>
            <div class="theme-grid">
                <label for="theme-blush" class="theme-label"><input type="radio" name="theme" id="theme-blush" value="blush" class="theme-option" checked><div class="theme-swatch"><span style="background:#D4A5A5;"></span><span style="background:#F8F4F0;"></span><span style="background:#A8B89C;"></span></div><div class="theme-info"><strong>Blush &amp; Sage</strong><small>Soft, romantic, elegant</small></div></label>
                <label for="theme-navy" class="theme-label"><input type="radio" name="theme" id="theme-navy" value="navy" class="theme-option"><div class="theme-swatch"><span style="background:#2C3E5D;"></span><span style="background:#F5F0E8;"></span><span style="background:#C9A96E;"></span></div><div class="theme-info"><strong>Navy &amp; Gold</strong><small>Classic, formal, timeless</small></div></label>
                <label for="theme-sage" class="theme-label"><input type="radio" name="theme" id="theme-sage" value="sage" class="theme-option"><div class="theme-swatch"><span style="background:#7A9E7E;"></span><span style="background:#F7F5F0;"></span><span style="background:#C4A882;"></span></div><div class="theme-info"><strong>Forest &amp; Linen</strong><small>Natural, earthy, serene</small></div></label>
                <label for="theme-ivory" class="theme-label"><input type="radio" name="theme" id="theme-ivory" value="ivory" class="theme-option"><div class="theme-swatch"><span style="background:#B5A898;"></span><span style="background:#FAFAF7;"></span><span style="background:#C8B89A;"></span></div><div class="theme-info"><strong>Ivory &amp; Champagne</strong><small>Neutral, clean, timeless</small></div></label>
                <label for="theme-dustyrose" class="theme-label"><input type="radio" name="theme" id="theme-dustyrose" value="dustyrose" class="theme-option"><div class="theme-swatch"><span style="background:#C2848A;"></span><span style="background:#FDF8F8;"></span><span style="background:#9B7B8C;"></span></div><div class="theme-info"><strong>Dusty Rose &amp; Mauve</strong><small>Romantic, moody ‚úø floral accents</small></div></label>
                <label for="theme-lavender" class="theme-label"><input type="radio" name="theme" id="theme-lavender" value="lavender" class="theme-option"><div class="theme-swatch"><span style="background:#9B8EC4;"></span><span style="background:#F8F7FC;"></span><span style="background:#B8A8C8;"></span></div><div class="theme-info"><strong>Lavender &amp; Silver</strong><small>Dreamy, soft ‚úø floral accents</small></div></label>
            </div>
        </div>

        <div style="text-align:center;padding:0 40px 10px;font-size:0.8rem;color:var(--text-light);">
            Have a saved session? <label style="color:var(--blush);cursor:pointer;font-weight:500;text-decoration:underline;">Load Progress <input type="file" accept=".json" style="display:none;" onchange="loadProgress(event)"></label>
        </div>
        <div class="generate-wrap">
            <button class="btn-generate" onclick="generateWebsite()" id="generateBtn">
                <span>&#10022;</span> Generate My Wedding Website
            </button>
            <div class="generate-note">Takes about 20 seconds &middot; Completely free &middot; No account required</div>
        </div>
    </div>

    <!-- LOADING -->
    <div class="loading-state" id="loadingState">
        <div class="loading-rings"><div class="ring"></div><div class="ring"></div><div class="ring"></div></div>
        <div class="loading-title">Creating your wedding website&hellip;</div>
        <div class="loading-sub" id="loadingMessage">Writing your love story</div>
    </div>

    <!-- RESULT -->
    <div id="resultSection">
        <div class="result-actions">
            <button class="btn-action btn-primary" onclick="downloadWebsite()">&#8595; Download Website</button>
            <button class="btn-action btn-sage" onclick="copyWebsite()">&#128203; Copy HTML</button>
            <button class="btn-action btn-secondary" onclick="saveProgress()" title="Save your form answers to come back later">&#128190; Save Progress</button>
            <button class="btn-action btn-secondary" onclick="resetForm()">&#8617; Start Over</button>
        </div>

        <!-- THEME SWITCHER -->
        <div style="background:white;border-radius:14px;padding:20px 24px;margin-bottom:20px;border:1px solid var(--border);">
            <div style="font-size:0.78rem;font-weight:600;color:var(--text);letter-spacing:0.08em;text-transform:uppercase;margin-bottom:14px;">üé® Switch Color Theme</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;">
                <button onclick="switchTheme('blush')" id="themeBtn_blush" style="padding:8px 14px;border-radius:20px;border:2px solid var(--border);background:white;cursor:pointer;font-size:0.78rem;font-weight:500;color:var(--text);transition:all 0.15s;">Blush &amp; Sage</button>
                <button onclick="switchTheme('navy')" id="themeBtn_navy" style="padding:8px 14px;border-radius:20px;border:2px solid var(--border);background:white;cursor:pointer;font-size:0.78rem;font-weight:500;color:var(--text);transition:all 0.15s;">Navy &amp; Gold</button>
                <button onclick="switchTheme('sage')" id="themeBtn_sage" style="padding:8px 14px;border-radius:20px;border:2px solid var(--border);background:white;cursor:pointer;font-size:0.78rem;font-weight:500;color:var(--text);transition:all 0.15s;">Forest &amp; Linen</button>
                <button onclick="switchTheme('ivory')" id="themeBtn_ivory" style="padding:8px 14px;border-radius:20px;border:2px solid var(--border);background:white;cursor:pointer;font-size:0.78rem;font-weight:500;color:var(--text);transition:all 0.15s;">Ivory &amp; Champagne</button>
                <button onclick="switchTheme('dustyrose')" id="themeBtn_dustyrose" style="padding:8px 14px;border-radius:20px;border:2px solid var(--border);background:white;cursor:pointer;font-size:0.78rem;font-weight:500;color:var(--text);transition:all 0.15s;">Dusty Rose</button>
                <button onclick="switchTheme('lavender')" id="themeBtn_lavender" style="padding:8px 14px;border-radius:20px;border:2px solid var(--border);background:white;cursor:pointer;font-size:0.78rem;font-weight:500;color:var(--text);transition:all 0.15s;">Lavender &amp; Silver</button>
            </div>
        </div>

        <!-- EDITABLE STORY -->
        <div style="background:white;border-radius:14px;padding:20px 24px;margin-bottom:20px;border:1px solid var(--border);">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                <div style="font-size:0.78rem;font-weight:600;color:var(--text);letter-spacing:0.08em;text-transform:uppercase;">‚úèÔ∏è Edit Your Story</div>
                <button onclick="applyStoryEdit()" style="padding:7px 18px;background:var(--sage);color:white;border:none;border-radius:20px;cursor:pointer;font-size:0.8rem;font-weight:500;">Apply Changes</button>
            </div>
            <p style="font-size:0.8rem;color:var(--text-light);margin-bottom:10px;">The AI wrote your story ‚Äî tweak any wording here, then click Apply Changes to update your preview.</p>
            <div id="storyEditor" contenteditable="true" style="border:1.5px solid var(--border);border-radius:8px;padding:14px;min-height:120px;font-size:0.9rem;line-height:1.8;color:var(--text);outline:none;"></div>
        </div>

        <div class="preview-frame-wrap">
            <div class="preview-bar">
                <div class="dot dot-r"></div><div class="dot dot-y"></div><div class="dot dot-g"></div>
                <div class="url-bar" id="previewUrl">yournames.netlify.app &mdash; preview</div>
            </div>
            <iframe id="previewFrame" title="Wedding Website Preview"></iframe>
        </div>

        <div class="affiliate-banner">
            <h3>Complete Your Wedding Planning</h3>
            <p>Everything you need ‚Äî hand-picked by Elegant Bride Co.</p>
            <div class="affiliate-grid">
                <a href="https://www.amazon.com/wedding/home?tag=elegantbridec-20" target="_blank" class="affiliate-card featured"><div class="aff-icon">&#127873;</div><div class="aff-name">Amazon Registry</div><div class="aff-desc">Build your registry</div></a>
                <a href="https://www.elegantbrideco.com/wedding-dresses" target="_blank" class="affiliate-card"><div class="aff-icon">&#128507;</div><div class="aff-name">Wedding Dresses</div><div class="aff-desc">Find your dream dress</div></a>
                <a href="https://www.elegantbrideco.com/best-wedding-invitations" target="_blank" class="affiliate-card"><div class="aff-icon">&#9993;&#65039;</div><div class="aff-name">Invitations</div><div class="aff-desc">Beautiful invite sets</div></a>
                <a href="https://www.elegantbrideco.com/decorations" target="_blank" class="affiliate-card"><div class="aff-icon">&#127800;</div><div class="aff-name">Wedding D&eacute;cor</div><div class="aff-desc">Style your venue</div></a>
                <a href="https://elegant-bride-planner.netlify.app" target="_blank" class="affiliate-card"><div class="aff-icon">&#128203;</div><div class="aff-name">Free Planner App</div><div class="aff-desc">Plan every detail</div></a>
            </div>
        </div>
    </div>

</div>

<footer class="site-footer">
    <p>Made with &hearts; by <a href="https://www.elegantbrideco.com">Elegant Bride Co.</a> &middot; Free wedding planning tools &amp; resources</p>
    <p style="margin-top:6px;">This site contains affiliate links. We may earn a small commission at no extra cost to you.</p>
</footer>

<script>
    let generatedHTML = '';
    let generatedData = null;
    let generatedStoryCopy = '';
    let uploadedPhotos = [];
    let heroPhoto = '';

    function handleHeroPhoto(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const MAX_W = 1400, MAX_H = 700;
                let w = img.width, h = img.height;
                if (w > MAX_W) { h = h * MAX_W / w; w = MAX_W; }
                if (h > MAX_H) { w = w * MAX_H / h; h = MAX_H; }
                canvas.width = w; canvas.height = h;
                canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                heroPhoto = canvas.toDataURL('image/jpeg', 0.82);
                const preview = document.getElementById('heroPhotoPreview');
                preview.innerHTML = `<img src="${heroPhoto}" style="width:100%;height:100%;object-fit:cover;">`;
                document.getElementById('heroRemoveBtn').style.display = 'block';
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    } // base64 encoded photos

    // ‚îÄ‚îÄ PHOTO UPLOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function handlePhotoUpload(event) {
        const files = Array.from(event.target.files);
        const remaining = 5 - uploadedPhotos.length;
        const toProcess = files.slice(0, remaining);

        toProcess.forEach(file => {
            if (file.size > 5 * 1024 * 1024) { alert(`${file.name} is too large. Max 5MB per photo.`); return; }
            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedPhotos.push({ src: e.target.result, name: file.name });
                renderPhotoThumbs();
            };
            reader.readAsDataURL(file);
        });
    }

    function renderPhotoThumbs() {
        const grid = document.getElementById('photoPreviewGrid');
        grid.innerHTML = uploadedPhotos.map((p, i) => `
            <div class="photo-thumb">
                <img src="${p.src}" alt="Photo ${i+1}">
                <button class="remove-photo" onclick="removePhoto(${i})">&#10005;</button>
            </div>
        `).join('');
    }

    function removePhoto(index) {
        uploadedPhotos.splice(index, 1);
        renderPhotoThumbs();
    }

    // ‚îÄ‚îÄ SCHEDULE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let scheduleItems = [
        { time: '', event: '', note: '' }
    ];

    function renderSchedule() {
        document.getElementById('scheduleItems').innerHTML = scheduleItems.map((item, i) => `
            <div class="schedule-item">
                <div class="field"><label>Time</label><input type="time" value="${item.time}" onchange="scheduleItems[${i}].time=this.value"></div>
                <div class="field"><label>Event</label><input type="text" value="${item.event}" placeholder="e.g. Ceremony begins" onchange="scheduleItems[${i}].event=this.value"></div>
                <div class="field"><label>Note <span class="hint">(optional)</span></label><input type="text" value="${item.note}" placeholder="e.g. Please be seated by 3:45" onchange="scheduleItems[${i}].note=this.value"></div>
                <button class="remove-btn" onclick="removeScheduleItem(${i})" title="Remove">&#10005;</button>
            </div>
        `).join('');
    }

    function addScheduleItem() {
        scheduleItems.push({ time: '', event: '', note: '' });
        renderSchedule();
    }

    function removeScheduleItem(index) {
        scheduleItems.splice(index, 1);
        renderSchedule();
    }

    renderSchedule();

    // ‚îÄ‚îÄ WEDDING PARTY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let partyMembers = [];

    function renderParty() {
        document.getElementById('partyMembers').innerHTML = partyMembers.map((m, i) => `
            <div style="background:var(--cream);border-radius:10px;padding:16px;margin-bottom:12px;border:1px solid var(--border);">
                <div style="display:grid;grid-template-columns:80px 1fr;gap:16px;align-items:start;margin-bottom:12px;">
                    <!-- Photo upload -->
                    <div>
                        <div style="width:80px;height:80px;border-radius:50%;border:2px dashed var(--border);overflow:hidden;cursor:pointer;position:relative;background:white;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:4px;"
                             onclick="document.getElementById('partyPhoto_${i}').click()">
                            ${m.photo
                                ? `<img src="${m.photo}" style="width:100%;height:100%;object-fit:cover;">`
                                : `<span style="font-size:1.4rem;">&#128100;</span><span style="font-size:0.6rem;color:var(--text-light);text-align:center;line-height:1.2;">Add<br>Photo</span>`
                            }
                        </div>
                        <input type="file" id="partyPhoto_${i}" accept="image/*" style="display:none" onchange="handlePartyPhoto(${i}, event)">
                        ${m.photo ? `<button onclick="partyMembers[${i}].photo='';renderParty();" style="display:block;width:80px;margin-top:4px;font-size:0.65rem;color:var(--text-light);background:none;border:none;cursor:pointer;text-align:center;">Remove</button>` : ''}
                    </div>
                    <!-- Fields -->
                    <div>
                        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:10px;">
                            <div class="field"><label>Name</label><input type="text" value="${m.name}" placeholder="e.g. Emily Johnson" onchange="partyMembers[${i}].name=this.value"></div>
                            <div class="field"><label>Role</label><input type="text" value="${m.role}" placeholder="e.g. Maid of Honor" onchange="partyMembers[${i}].role=this.value"></div>
                            <div class="field"><label>Relation <span class="hint">(optional)</span></label><input type="text" value="${m.relation}" placeholder="e.g. Sister of the bride" onchange="partyMembers[${i}].relation=this.value"></div>
                        </div>
                        <div style="display:grid;grid-template-columns:1fr auto;gap:10px;align-items:end;">
                            <div class="field"><label>Tell us about them <span class="hint">(personality, fun facts, how you know them)</span></label><input type="text" value="${m.note}" placeholder="e.g. My college roommate who convinced me to swipe right" onchange="partyMembers[${i}].note=this.value"></div>
                            <button class="remove-btn" onclick="removePartyMember(${i})" title="Remove" style="margin-bottom:2px;">&#10005;</button>
                        </div>
                    </div>
                </div>
                <div>
                    <label style="font-size:0.78rem;font-weight:500;color:var(--text);display:block;margin-bottom:8px;">Blurb tone for ${m.name || 'this person'}:</label>
                    <div style="display:flex;gap:8px;flex-wrap:wrap;">
                        ${['Sweet','Funny','Roast','Heartfelt','Professional'].map(tone => `
                        <label style="display:flex;align-items:center;gap:4px;padding:6px 12px;border:1.5px solid ${m.tone===tone?'var(--blush)':'var(--border)'};border-radius:20px;cursor:pointer;font-size:0.78rem;font-weight:500;background:${m.tone===tone?'var(--blush-light)':'white'};transition:all 0.15s;">
                            <input type="radio" name="partytone_${i}" value="${tone}" ${m.tone===tone?'checked':''} onchange="partyMembers[${i}].tone=this.value;renderParty();" style="display:none;">
                            ${tone}
                        </label>`).join('')}
                    </div>
                </div>
            </div>
        `).join('');
    }

    function handlePartyPhoto(index, event) {
        const file = event.target.files[0];
        if (!file) return;
        if (file.size > 5 * 1024 * 1024) { alert('Photo too large. Max 5MB.'); return; }
        // Compress to ~200x200 circle
        const reader = new FileReader();
        reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const SIZE = 300;
                canvas.width = SIZE; canvas.height = SIZE;
                const ctx = canvas.getContext('2d');
                // Crop to square from center
                const min = Math.min(img.width, img.height);
                const sx = (img.width - min) / 2;
                const sy = (img.height - min) / 2;
                ctx.drawImage(img, sx, sy, min, min, 0, 0, SIZE, SIZE);
                partyMembers[index].photo = canvas.toDataURL('image/jpeg', 0.75);
                renderParty();
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }

    function addPartyMember() {
        partyMembers.push({ name: '', role: '', relation: '', note: '', tone: 'Sweet', photo: '' });
        renderParty();
    }

    function removePartyMember(index) {
        partyMembers.splice(index, 1);
        renderParty();
    }

    // ‚îÄ‚îÄ HOTELS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let hotelItems = [];

    function renderHotels() {
        document.getElementById('hotelItems').innerHTML = hotelItems.map((h, i) => `
            <div style="background:var(--cream);border-radius:10px;padding:16px;margin-bottom:12px;border:1px solid var(--border);">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;">
                    <div class="field"><label>Hotel Name</label><input type="text" value="${h.name}" placeholder="e.g. Marriott Downtown" onchange="hotelItems[${i}].name=this.value"></div>
                    <div class="field"><label>Price Range <span class="hint">(per night)</span></label>
                        <select onchange="hotelItems[${i}].price=this.value">
                            <option value="" ${h.price===''?'selected':''}>Select range...</option>
                            <option value="Under $100/night" ${h.price==='Under $100/night'?'selected':''}>Under $100/night</option>
                            <option value="$100‚Äì$150/night" ${h.price==='$100‚Äì$150/night'?'selected':''}>$100‚Äì$150/night</option>
                            <option value="$150‚Äì$200/night" ${h.price==='$150‚Äì$200/night'?'selected':''}>$150‚Äì$200/night</option>
                            <option value="$200‚Äì$300/night" ${h.price==='$200‚Äì$300/night'?'selected':''}>$200‚Äì$300/night</option>
                            <option value="$300+/night" ${h.price==='$300+/night'?'selected':''}>$300+/night</option>
                        </select>
                    </div>
                    <div class="field"><label>Address <span class="hint">(optional)</span></label><input type="text" value="${h.address}" placeholder="e.g. 123 Main St, Austin TX" onchange="hotelItems[${i}].address=this.value"></div>
                    <div class="field"><label>Booking Link <span class="hint">(optional)</span></label><input type="url" value="${h.bookingUrl}" placeholder="https://..." onchange="hotelItems[${i}].bookingUrl=this.value"></div>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <div class="field" style="flex:1;margin-right:10px;"><label>Note <span class="hint">(e.g. "We have a room block ‚Äî mention our wedding")</span></label><input type="text" value="${h.note}" placeholder="e.g. Ask for the Anderson wedding block rate" onchange="hotelItems[${i}].note=this.value"></div>
                    <button class="remove-btn" onclick="removeHotel(${i})" title="Remove">&#10005;</button>
                </div>
            </div>
        `).join('');
    }

    function addHotel() {
        hotelItems.push({ name: '', address: '', price: '', bookingUrl: '', note: '' });
        renderHotels();
    }

    function removeHotel(index) {
        hotelItems.splice(index, 1);
        renderHotels();
    }

    renderHotels();

    // ‚îÄ‚îÄ REGISTRY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function updateRegStyle(id, checked) {
        const wrap = document.getElementById('reg-' + id + '-wrap');
        if (wrap) {
            wrap.style.borderColor = checked ? 'var(--blush)' : 'var(--border)';
            wrap.style.background = checked ? 'var(--blush-light, #fdf0f0)' : 'var(--cream)';
        }
    }

    // ‚îÄ‚îÄ REGISTRY TOGGLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    document.getElementById('reg-custom').addEventListener('change', function() {
        document.getElementById('customRegistryFields').style.display = this.checked ? 'block' : 'none';
    });

    // ‚îÄ‚îÄ THEME COLORS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function getTheme(name) {
        const themes = {
            blush:    { primary:'#D4A5A5', primaryDark:'#B88A8A', accent:'#A8B89C', bg:'#FBF8F5', light:'#F0E8E8', text:'#4A4540', headFont:"'Cormorant Garamond', serif", bodyFont:"'Jost', sans-serif", floral:false },
            navy:     { primary:'#2C3E5D', primaryDark:'#1E2D45', accent:'#C9A96E', bg:'#F5F0E8', light:'#E8E0D0', text:'#2C3040', headFont:"'Playfair Display', serif", bodyFont:"'Lato', sans-serif", floral:false },
            sage:     { primary:'#7A9E7E', primaryDark:'#5E8563', accent:'#C4A882', bg:'#F7F5F0', light:'#E0EAE0', text:'#3A3830', headFont:"'Cormorant Garamond', serif", bodyFont:"'Raleway', sans-serif", floral:false },
            ivory:    { primary:'#B5A898', primaryDark:'#9A8D7E', accent:'#C8B89A', bg:'#FAFAF7', light:'#F0EDE8', text:'#4A4540', headFont:"'Cormorant Garamond', serif", bodyFont:"'Jost', sans-serif", floral:false },
            dustyrose:{ primary:'#C2848A', primaryDark:'#A96870', accent:'#9B7B8C', bg:'#FDF8F8', light:'#F5E8EC', text:'#4A3840', headFont:"'Cormorant Garamond', serif", bodyFont:"'Jost', sans-serif", floral:true },
            lavender: { primary:'#9B8EC4', primaryDark:'#7B6EA4', accent:'#B8A8C8', bg:'#F8F7FC', light:'#EDE8F5', text:'#3A3848', headFont:"'Cormorant Garamond', serif", bodyFont:"'Jost', sans-serif", floral:true }
        };
        return themes[name] || themes.blush;
    }


    // ‚îÄ‚îÄ EDIT MODE SCRIPT (injected into generated HTML) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const EDIT_JS_CODE = '(function(){\nvar em=false;\nvar btn=document.createElement(\'button\');\nbtn.id=\'eb-btn\';\nbtn.textContent=\'\\u270F\\uFE0F Edit Website\';\nbtn.style.cssText=\'position:fixed;bottom:24px;right:24px;z-index:9999;background:#fff;border:2px solid #D4A5A5;border-radius:30px;padding:10px 22px;font-size:0.85rem;font-weight:600;cursor:pointer;box-shadow:0 4px 20px rgba(0,0,0,0.12);font-family:sans-serif;transition:all 0.2s;\';\nbtn.onclick=toggle;document.body.appendChild(btn);\nvar bar=document.createElement(\'div\');bar.id=\'eb-bar\';\nbar.style.cssText=\'position:fixed;top:0;left:0;right:0;z-index:10000;background:#4A4540;color:white;padding:10px 20px;display:none;align-items:center;justify-content:space-between;font-family:sans-serif;font-size:0.82rem;\';\nbar.innerHTML=\'<span style=\\"opacity:0.8\\">\\u270F\\uFE0F Click any text to edit &bull; Hover photos to swap</span><div style=\\"display:flex;gap:8px;\\"><button id=\\"eb-save\\" style=\\"background:#A8B89C;color:white;border:none;padding:7px 18px;border-radius:20px;cursor:pointer;font-weight:600;font-size:0.8rem;\\">\\uD83D\\uDCBE Save & Download</button><button id=\\"eb-done\\" style=\\"background:transparent;color:rgba(255,255,255,0.6);border:1px solid rgba(255,255,255,0.3);padding:7px 14px;border-radius:20px;cursor:pointer;font-size:0.8rem;\\">Done</button></div>\';\ndocument.body.appendChild(bar);\nvar sty=document.createElement(\'style\');\nsty.textContent=\'.eb-on{outline:2px dashed #D4A5A5!important;cursor:text!important;border-radius:3px;min-height:1em;}.eb-wrap{position:relative!important;}.eb-ov{position:absolute;inset:0;background:rgba(0,0,0,0.42);color:white;display:flex;align-items:center;justify-content:center;font-size:0.82rem;font-weight:600;font-family:sans-serif;cursor:pointer;border-radius:inherit;opacity:0;transition:opacity 0.18s;}.eb-wrap:hover .eb-ov{opacity:1;}.eb-x{position:absolute;top:5px;right:5px;background:rgba(212,165,165,0.95);color:white;border:none;border-radius:50%;width:22px;height:22px;font-size:11px;cursor:pointer;display:none;align-items:center;justify-content:center;z-index:10;line-height:1;}.eb-deletable:hover .eb-x,.eb-deletable:focus-within .eb-x{display:flex;}\';\ndocument.head.appendChild(sty);\nfunction toggle(){em=!em;bar.style.display=em?\'flex\':\'none\';btn.textContent=em?\'\\u2715 Stop Editing\':\'\\u270F\\uFE0F Edit Website\';btn.style.background=em?\'#fef0f0\':\'#fff\';em?enable():disable();}\ndocument.addEventListener(\'DOMContentLoaded\',function(){\n  document.getElementById(\'eb-save\').addEventListener(\'click\',save);\n  document.getElementById(\'eb-done\').addEventListener(\'click\',toggle);\n});\nfunction enable(){\n  document.querySelectorAll(\'.eb-text\').forEach(function(el){el.contentEditable=\'true\';el.classList.add(\'eb-on\');});\n  document.querySelectorAll(\'.eb-photo\').forEach(function(img){\n    var w=img.parentElement;w.classList.add(\'eb-wrap\');\n    if(!w.querySelector(\'.eb-ov\')){var ov=document.createElement(\'div\');ov.className=\'eb-ov\';ov.innerHTML=\'\\uD83D\\uDDBC&nbsp;Replace Photo\';ov.onclick=function(){swap(img);};w.appendChild(ov);}\n  });\n  document.querySelectorAll(\'.eb-deletable\').forEach(function(el){\n    el.style.position=\'relative\';\n    if(!el.querySelector(\'.eb-x\')){var d=document.createElement(\'button\');d.className=\'eb-x\';d.innerHTML=\'&times;\';d.title=\'Remove\';d.onclick=function(e){e.stopPropagation();el.style.opacity=\'0\';el.style.transition=\'opacity 0.3s\';setTimeout(function(){el.remove();},300);};el.appendChild(d);}\n  });\n}\nfunction disable(){\n  document.querySelectorAll(\'.eb-text\').forEach(function(el){el.contentEditable=\'false\';el.classList.remove(\'eb-on\');});\n  document.querySelectorAll(\'.eb-ov,.eb-x\').forEach(function(el){el.remove();});\n  document.querySelectorAll(\'.eb-wrap\').forEach(function(el){el.classList.remove(\'eb-wrap\');});\n}\nfunction swap(img){var inp=document.createElement(\'input\');inp.type=\'file\';inp.accept=\'image/*\';inp.onchange=function(e){var f=e.target.files[0];if(!f)return;var r=new FileReader();r.onload=function(ev){var i=new Image();i.onload=function(){var c=document.createElement(\'canvas\');var mw=1400,w=i.width,h=i.height;if(w>mw){h=Math.round(h*mw/w);w=mw;}c.width=w;c.height=h;c.getContext(\'2d\').drawImage(i,0,0,w,h);img.src=c.toDataURL(\'image/jpeg\',0.82);};i.src=ev.target.result;};r.readAsDataURL(f);};inp.click();}\nfunction save(){\n  disable();em=false;bar.style.display=\'none\';btn.textContent=\'\\u270F\\uFE0F Edit Website\';btn.style.background=\'#fff\';\n  var cl=document.documentElement.cloneNode(true);\n  [\'eb-btn\',\'eb-bar\'].forEach(function(id){var el=cl.querySelector(\'#\'+id);if(el)el.remove();});\n  cl.querySelectorAll(\'style\').forEach(function(s){if(s.textContent.indexOf(\'.eb-on\')>-1)s.remove();});\n  var h=\'<!DOCTYPE html>\\n\'+cl.outerHTML;\n  var b=new Blob([h],{type:\'text/html\'});var a=document.createElement(\'a\');a.href=URL.createObjectURL(b);a.download=\'my-wedding-website.html\';a.click();\n}\n})();';
    const EDIT_SCRIPT_TAG = String.fromCharCode(60) + 'script>' + EDIT_JS_CODE + String.fromCharCode(60) + '/script>';

        // ‚îÄ‚îÄ BUILD WEBSITE HTML ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function buildWebsiteHTML(data, storyCopy) {
        const t = getTheme(data.theme);
        const wDate = data.weddingDate ? new Date(data.weddingDate + 'T12:00:00') : null;
        const fDate = wDate ? wDate.toLocaleDateString('en-US', {weekday:'long',year:'numeric',month:'long',day:'numeric'}) : '';
        const fTime = data.ceremonyTime ? new Date('2000-01-01T' + data.ceremonyTime).toLocaleTimeString('en-US', {hour:'numeric',minute:'2-digit'}) : '';
        const reception = (data.receptionLocation && data.receptionLocation.trim()) ? data.receptionLocation : data.ceremonyLocation;

        // Map variables (used in details section)
        const ceremonyAddr = data.ceremonyAddress || data.ceremonyLocation;
        const receptionAddr = (data.receptionAddress && data.receptionAddress.trim()) ? data.receptionAddress : (data.receptionLocation && data.receptionLocation !== data.ceremonyLocation ? data.receptionLocation : null);
        const hasDualMap = ceremonyAddr && receptionAddr;

        // Hotels
        const validHotels = (data.hotels || []).filter(h => h.name);

        // Registry links
        const registryLinks = {
            amazon:    { name: 'Amazon Registry', url: 'https://www.amazon.com/wedding/home?tag=elegantbridec-20', emoji: '&#127873;' },
            honeyfund: { name: 'Honeyfund', url: 'https://www.honeyfund.com/', emoji: '&#127965;' },
        };
        if (data.customRegName && data.customRegUrl) registryLinks.custom = { name: data.customRegName, url: data.customRegUrl, emoji: '&#128279;' };

        const selectedRegistries = data.selectedRegistries.map(key => registryLinks[key]).filter(Boolean);

        const registrySection = selectedRegistries.length > 0 ? `
        <section id="registry" style="padding:80px 20px;background:${t.light};">
          <div style="max-width:700px;margin:0 auto;text-align:center;">
            
            <h2 style="font-family:${t.headFont};font-size:clamp(1.8rem,4vw,2.6rem);font-weight:300;color:${t.text};margin-bottom:16px;">Registry</h2>
            <p style="font-size:1rem;line-height:1.8;color:${t.text};opacity:0.75;max-width:500px;margin:0 auto 28px;font-weight:300;">Your presence is the greatest gift. But if you'd like to celebrate with something special, we're registered at:</p>
            <div style="display:flex;gap:14px;justify-content:center;flex-wrap:wrap;">
              ${selectedRegistries.map((r, i) => `<a href="${r.url}" target="_blank" style="display:inline-flex;align-items:center;gap:8px;padding:14px 28px;border-radius:50px;${i===0 ? `background:${t.primary};color:white;` : `background:white;color:${t.primary};border:2px solid ${t.primary};`}text-decoration:none;font-size:0.9rem;font-weight:500;letter-spacing:0.04em;">${r.emoji} ${r.name}</a>`).join('')}
            </div>
          </div>
        </section>` : '';

        // Gallery section
        const gallerySection = data.photos && data.photos.length > 0 ? `
        <section id="gallery" style="padding:80px 20px;background:${t.bg};">
          <div style="max-width:800px;margin:0 auto;text-align:center;">
            
            <h2 style="font-family:${t.headFont};font-size:clamp(1.8rem,4vw,2.6rem);font-weight:300;color:${t.text};margin-bottom:36px;">Our Gallery</h2>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;">
              ${data.photos.map(p => `<div class="eb-deletable eb-photo-wrap" style="border-radius:12px;overflow:hidden;aspect-ratio:4/3;position:relative;"><img src="${p.src}" class="eb-photo" alt="Wedding photo" style="width:100%;height:100%;object-fit:cover;display:block;"></div>`).join('')}
            </div>
          </div>
        </section>` : '';

        // Schedule section
        const validSchedule = data.schedule.filter(s => s.time && s.event);
        const scheduleSection = validSchedule.length > 0 ? `
        <section id="schedule" style="padding:80px 20px;background:${t.light};">
          <div style="max-width:600px;margin:0 auto;text-align:center;">
            
            <h2 style="font-family:${t.headFont};font-size:clamp(1.8rem,4vw,2.6rem);font-weight:300;color:${t.text};margin-bottom:36px;">Day-of Schedule</h2>
            <div style="text-align:left;">
              ${validSchedule.map(s => {
                const fTime = new Date('2000-01-01T' + s.time).toLocaleTimeString('en-US', {hour:'numeric',minute:'2-digit'});
                return `<div style="display:flex;gap:20px;margin-bottom:24px;align-items:flex-start;">
                  <div style="min-width:80px;text-align:right;font-size:0.85rem;font-weight:600;color:${t.primary};padding-top:2px;">${fTime}</div>
                  <div style="width:10px;height:10px;border-radius:50%;background:${t.primary};flex-shrink:0;margin-top:4px;box-shadow:0 0 0 3px ${t.light},0 0 0 4px ${t.primary};"></div>
                  <div>
                    <div style="font-weight:500;color:${t.text};">${s.event}</div>
                    ${s.note ? `<div style="font-size:0.85rem;color:${t.text};opacity:0.55;margin-top:2px;">${s.note}</div>` : ''}
                  </div>
                </div>`;
              }).join('')}
            </div>
          </div>
        </section>` : '';

        // Wedding party section
        const validParty = data.partyMembers.filter(p => p.name && p.role);
        const partySection = validParty.length > 0 ? `
        <section id="party" style="padding:80px 20px;background:${t.bg};">
          <div style="max-width:860px;margin:0 auto;text-align:center;">
            
            <h2 style="font-family:${t.headFont};font-size:clamp(1.8rem,4vw,2.6rem);font-weight:300;color:${t.text};margin-bottom:36px;">Wedding Party</h2>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;text-align:left;">
              ${validParty.map(p => `
                <div style="background:white;border-radius:14px;padding:24px 20px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 2px 12px rgba(0,0,0,0.04);text-align:center;">
                  ${p.photo
                    ? `<img src="${p.photo}" class="eb-photo" style="width:80px;height:80px;border-radius:50%;object-fit:cover;margin:0 auto 14px;display:block;border:3px solid ${t.light};">`
                    : `<div style="width:80px;height:80px;border-radius:50%;background:${t.light};margin:0 auto 14px;display:flex;align-items:center;justify-content:center;font-size:1.6rem;">&#128100;</div>`
                  }
                  <div class="eb-text" style="font-weight:600;color:${t.text};margin-bottom:2px;font-size:1rem;">${p.name}</div>
                  <div class="eb-text" style="font-size:0.72rem;color:${t.primary};font-weight:600;letter-spacing:0.06em;text-transform:uppercase;margin-bottom:4px;">${p.role}</div>
                  ${p.relation ? `<div style="font-size:0.78rem;color:${t.text};opacity:0.45;margin-bottom:10px;">${p.relation}</div>` : '<div style="margin-bottom:10px;"></div>'}
                  ${data.partyBlurbs && data.partyBlurbs[p.name] ? `<div style="font-size:0.85rem;color:${t.text};opacity:0.7;line-height:1.6;font-style:italic;border-top:1px solid rgba(0,0,0,0.06);padding-top:10px;text-align:left;">"${data.partyBlurbs[p.name]}"</div>` : ''}
                </div>
              `).join('')}
            </div>
          </div>
        </section>` : '';

        // Accommodations section (hotels only ‚Äî maps moved to details)
        const mapSection = validHotels.length > 0 ? `
        <section style="padding:80px 20px;background:${t.light};">
          <div style="max-width:860px;margin:0 auto;">
            <div style="text-align:center;margin-bottom:40px;">
              
              <h2 style="font-family:${t.headFont};font-size:clamp(1.8rem,4vw,2.6rem);font-weight:300;color:${t.text};">Recommended Hotels</h2>
            </div>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;">
              ${validHotels.map(h => `
              <div class="eb-deletable" style="background:white;border-radius:12px;padding:20px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 2px 10px rgba(0,0,0,0.04);">
                <div class="eb-text" style="font-weight:600;color:${t.text};font-size:0.95rem;margin-bottom:4px;">${h.name}</div>
                ${h.price ? `<div class="eb-text" style="font-size:0.78rem;color:${t.primary};font-weight:600;margin-bottom:6px;">${h.price}</div>` : ''}
                ${h.address ? `<div style="font-size:0.8rem;color:${t.text};opacity:0.55;margin-bottom:8px;">&#128205; ${h.address}</div>` : ''}
                ${h.note ? `<div class="eb-text" style="font-size:0.82rem;color:${t.text};opacity:0.7;font-style:italic;margin-bottom:12px;">${h.note}</div>` : ''}
                ${h.bookingUrl ? `<a href="${h.bookingUrl}" target="_blank" style="display:inline-block;padding:8px 18px;background:${t.primary};color:white;border-radius:20px;text-decoration:none;font-size:0.8rem;font-weight:500;">Book Now &rarr;</a>` : ''}
              </div>`).join('')}
            </div>
          </div>
        </section>` : '';

        // Build nav links
        const navLinks = [
            '<a href="#story" onclick="event.preventDefault();document.getElementById(\'story\').scrollIntoView({behavior:\'smooth\'});">Our Story</a>',
            '<a href="#details" onclick="event.preventDefault();document.getElementById(\'details\').scrollIntoView({behavior:\'smooth\'});">Details</a>',
            validSchedule.length > 0 ? '<a href="#schedule" onclick="event.preventDefault();document.getElementById(\'schedule\').scrollIntoView({behavior:\'smooth\'});">Schedule</a>' : '',
            validParty.length > 0 ? '<a href="#party" onclick="event.preventDefault();document.getElementById(\'party\').scrollIntoView({behavior:\'smooth\'});">Wedding Party</a>' : '',
            data.photos && data.photos.length > 0 ? '<a href="#gallery" onclick="event.preventDefault();document.getElementById(\'gallery\').scrollIntoView({behavior:\'smooth\'});">Gallery</a>' : '',
            selectedRegistries.length > 0 ? '<a href="#registry" onclick="event.preventDefault();document.getElementById(\'registry\').scrollIntoView({behavior:\'smooth\'});">Registry</a>' : '',
        ].filter(Boolean).join('\n    ');

        return `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>${data.name1} &amp; ${data.name2}</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Jost:wght@300;400;500&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400&family=Raleway:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{font-family:${t.bodyFont};background:${t.bg};color:${t.text};}
nav{position:fixed;top:0;left:0;right:0;background:rgba(255,255,255,0.96);backdrop-filter:blur(10px);border-bottom:1px solid rgba(0,0,0,0.06);z-index:100;padding:0 30px;display:flex;align-items:center;justify-content:space-between;height:58px;}
.nav-names{font-family:${t.headFont};font-size:1.1rem;color:${t.primary};font-weight:400;white-space:nowrap;}
.nav-links{display:flex;gap:20px;overflow-x:auto;}
.nav-links a{text-decoration:none;font-size:0.75rem;letter-spacing:0.1em;text-transform:uppercase;color:${t.text};opacity:0.65;font-weight:500;transition:opacity 0.2s;white-space:nowrap;cursor:pointer;}
.nav-links a:hover{opacity:1;color:${t.primary};}
@keyframes floatDown{0%,100%{transform:translateY(0)}50%{transform:translateY(6px)}}
@media(max-width:600px){nav{padding:0 16px;}.nav-links{gap:12px;}}
</style>
</head>
<body>

<nav>
  <div class="nav-names">${data.name1} &amp; ${data.name2}</div>
  <div class="nav-links">
    ${navLinks}
  </div>
</nav>

<!-- HERO PHOTO BANNER -->
${data.heroPhoto ? `<div style="width:100%;height:55vh;min-height:300px;max-height:500px;overflow:hidden;position:relative;margin-top:58px;">
  <img src="${data.heroPhoto}" class="eb-photo" style="width:100%;height:100%;object-fit:cover;display:block;">
</div>` : ''}

<!-- NAMES & DATE -->
<section style="padding:${data.heroPhoto ? '60px' : '110px'} 30px 65px;background:${t.bg};text-align:center;position:relative;overflow:hidden;${!data.heroPhoto ? 'margin-top:58px;' : ''}">
  ${t.floral ? `
  <svg xmlns='http://www.w3.org/2000/svg' width='130' height='230' viewBox='0 0 130 230' style='position:absolute;left:0;bottom:0;opacity:0.14;pointer-events:none;' aria-hidden='true'>
    <g fill='${t.primary}'>
      <ellipse cx='38' cy='188' rx='22' ry='10' transform='rotate(-30 38 188)'/>
      <ellipse cx='22' cy='162' rx='17' ry='8' transform='rotate(-50 22 162)'/>
      <ellipse cx='58' cy='175' rx='19' ry='9' transform='rotate(-10 58 175)'/>
      <ellipse cx='28' cy='138' rx='14' ry='6' transform='rotate(-40 28 138)'/>
      <ellipse cx='62' cy='152' rx='16' ry='7' transform='rotate(10 62 152)'/>
      <ellipse cx='12' cy='115' rx='11' ry='5' transform='rotate(-60 12 115)'/>
      <circle cx='40' cy='194' r='6' fill='${t.accent}' opacity='0.8'/>
      <circle cx='24' cy='168' r='5' fill='${t.accent}' opacity='0.7'/>
      <circle cx='60' cy='181' r='5' fill='${t.accent}' opacity='0.7'/>
      <line x1='40' y1='198' x2='40' y2='95' stroke='${t.primary}' stroke-width='1.5' opacity='0.3'/>
      <line x1='40' y1='162' x2='22' y2='144' stroke='${t.primary}' stroke-width='1' opacity='0.25'/>
      <line x1='40' y1='175' x2='60' y2='157' stroke='${t.primary}' stroke-width='1' opacity='0.25'/>
      <line x1='40' y1='142' x2='12' y2='122' stroke='${t.primary}' stroke-width='1' opacity='0.2'/>
    </g>
  </svg>
  <svg xmlns='http://www.w3.org/2000/svg' width='130' height='230' viewBox='0 0 130 230' style='position:absolute;right:0;bottom:0;opacity:0.14;pointer-events:none;transform:scaleX(-1);' aria-hidden='true'>
    <g fill='${t.primary}'>
      <ellipse cx='38' cy='188' rx='22' ry='10' transform='rotate(-30 38 188)'/>
      <ellipse cx='22' cy='162' rx='17' ry='8' transform='rotate(-50 22 162)'/>
      <ellipse cx='58' cy='175' rx='19' ry='9' transform='rotate(-10 58 175)'/>
      <ellipse cx='28' cy='138' rx='14' ry='6' transform='rotate(-40 28 138)'/>
      <ellipse cx='62' cy='152' rx='16' ry='7' transform='rotate(10 62 152)'/>
      <ellipse cx='12' cy='115' rx='11' ry='5' transform='rotate(-60 12 115)'/>
      <circle cx='40' cy='194' r='6' fill='${t.accent}' opacity='0.8'/>
      <circle cx='24' cy='168' r='5' fill='${t.accent}' opacity='0.7'/>
      <circle cx='60' cy='181' r='5' fill='${t.accent}' opacity='0.7'/>
      <line x1='40' y1='198' x2='40' y2='95' stroke='${t.primary}' stroke-width='1.5' opacity='0.3'/>
      <line x1='40' y1='162' x2='22' y2='144' stroke='${t.primary}' stroke-width='1' opacity='0.25'/>
      <line x1='40' y1='175' x2='60' y2='157' stroke='${t.primary}' stroke-width='1' opacity='0.25'/>
      <line x1='40' y1='142' x2='12' y2='122' stroke='${t.primary}' stroke-width='1' opacity='0.2'/>
    </g>
  </svg>` : ''}
  <div style="position:relative;z-index:1;">
    <div style="font-family:${t.headFont};font-size:clamp(2.6rem,6vw,4.8rem);font-weight:300;line-height:1.1;color:${t.text};margin-bottom:22px;letter-spacing:0.02em;">
      <span class="eb-text">${data.name1}</span>
      <div style="font-family:${t.headFont};font-style:italic;color:${t.primary};font-size:0.42em;margin:10px 0;letter-spacing:0.12em;font-weight:300;">and</div>
      <span class="eb-text">${data.name2}</span>
    </div>
    ${fDate ? `<div style="display:flex;align-items:center;justify-content:center;gap:14px;">
      <span style="display:block;width:36px;height:1px;background:${t.primary};opacity:0.35;"></span>
      <div class="eb-text" style="font-size:0.8rem;letter-spacing:0.2em;text-transform:uppercase;color:${t.text};opacity:0.55;font-weight:400;">${fDate}</div>
      <span style="display:block;width:36px;height:1px;background:${t.primary};opacity:0.35;"></span>
    </div>` : ''}
  </div>
</section>

<!-- OUR STORY -->
<section id="story" style="padding:80px 20px;background:${t.light};">
  <div style="max-width:700px;margin:0 auto;">
    <div style="text-align:center;margin-bottom:40px;">
      <h2 style="font-family:${t.headFont};font-size:clamp(1.8rem,4vw,2.6rem);font-weight:300;color:${t.text};line-height:1.2;">Our Story</h2>
    </div>
    <div style="font-size:1.05rem;line-height:1.9;color:${t.text};font-weight:300;">
      ${storyCopy}
    </div>
  </div>
</section>

<!-- DETAILS -->
<section id="details" style="padding:80px 20px;background:${t.light};position:relative;">
  ${t.floral ? `<div style="position:absolute;top:10px;left:30px;font-size:3rem;opacity:0.07;pointer-events:none;">üå∑</div>` : ''}
  <div style="max-width:800px;margin:0 auto;text-align:center;position:relative;z-index:1;">
    
    <h2 style="font-family:${t.headFont};font-size:clamp(1.8rem,4vw,2.8rem);font-weight:300;color:${t.text};margin-bottom:36px;line-height:1.2;">Wedding Details</h2>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;text-align:center;margin-bottom:${ceremonyAddr ? '40px' : '0'};">
      ${fDate ? `<div style="background:white;border-radius:14px;padding:22px 16px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 2px 12px rgba(0,0,0,0.04);"><div style="font-size:1.5rem;margin-bottom:8px;">&#128197;</div><div style="font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;color:${t.accent};font-weight:600;margin-bottom:5px;">Date</div><div class="eb-text" style="font-size:0.88rem;color:${t.text};line-height:1.5;">${fDate}</div></div>` : ''}
      <div style="background:white;border-radius:14px;padding:22px 16px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 2px 12px rgba(0,0,0,0.04);"><div style="font-size:1.5rem;margin-bottom:8px;">&#128146;</div><div style="font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;color:${t.accent};font-weight:600;margin-bottom:5px;">Ceremony</div><div class="eb-text" style="font-size:0.88rem;color:${t.text};line-height:1.5;">${data.ceremonyLocation || 'TBA'}${fTime ? '<br>' + fTime : ''}</div></div>
      <div style="background:white;border-radius:14px;padding:22px 16px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 2px 12px rgba(0,0,0,0.04);"><div style="font-size:1.5rem;margin-bottom:8px;">&#127942;</div><div style="font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;color:${t.accent};font-weight:600;margin-bottom:5px;">Reception</div><div class="eb-text" style="font-size:0.88rem;color:${t.text};line-height:1.5;">${reception || 'TBA'}</div></div>
      ${data.dressCode ? `<div style="background:white;border-radius:14px;padding:22px 16px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 2px 12px rgba(0,0,0,0.04);"><div style="font-size:1.5rem;margin-bottom:8px;">&#128507;</div><div style="font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;color:${t.accent};font-weight:600;margin-bottom:5px;">Dress Code</div><div class="eb-text" style="font-size:0.88rem;color:${t.text};line-height:1.5;">${data.dressCode}</div></div>` : ''}
    </div>
    ${ceremonyAddr ? `
    <div style="display:grid;grid-template-columns:${hasDualMap ? '1fr 1fr' : '1fr'};gap:24px;text-align:left;">
      <div>
        <div style="font-weight:600;color:${t.text};margin-bottom:6px;font-size:0.9rem;">&#128146; Ceremony Location</div>
        <div style="font-size:0.85rem;color:${t.text};opacity:0.6;margin-bottom:10px;">${ceremonyAddr}</div>
        <div style="border-radius:12px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.08);">
          <iframe src="https://maps.google.com/maps?q=${encodeURIComponent(ceremonyAddr)}&output=embed&z=15" width="100%" height="260" style="border:0;display:block;" allowfullscreen loading="lazy"></iframe>
        </div>
      </div>
      ${hasDualMap ? `
      <div>
        <div style="font-weight:600;color:${t.text};margin-bottom:6px;font-size:0.9rem;">&#127942; Reception Venue</div>
        <div style="font-size:0.85rem;color:${t.text};opacity:0.6;margin-bottom:10px;">${receptionAddr}</div>
        <div style="border-radius:12px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.08);">
          <iframe src="https://maps.google.com/maps?q=${encodeURIComponent(receptionAddr)}&output=embed&z=15" width="100%" height="260" style="border:0;display:block;" allowfullscreen loading="lazy"></iframe>
        </div>
      </div>` : ''}
    </div>` : ''}
  </div>
</section>

${scheduleSection}
${partySection}
${gallerySection}
${mapSection}
${registrySection}

<footer style="background:${t.text};color:white;text-align:center;padding:50px 20px;">
  <div style="font-family:${t.headFont};font-size:2rem;font-weight:300;margin-bottom:8px;opacity:0.9;">${data.name1} &amp; ${data.name2}</div>
  ${fDate ? `<div style="font-size:0.85rem;opacity:0.4;letter-spacing:0.1em;margin-bottom:20px;">${fDate}</div>` : ''}
  <div style="font-size:0.72rem;opacity:0.25;letter-spacing:0.08em;">Website created with <a href="https://www.elegantbrideco.com" target="_blank" style="color:white;">Elegant Bride Co.</a></div>
</footer>

${EDIT_SCRIPT_TAG}
</body></html>`;
    }

    // ‚îÄ‚îÄ GENERATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const loadingMessages = ['Writing your love story...','Designing your website...','Building your gallery...','Adding the finishing touches...','Almost ready...'];
    let msgInterval;

    async function generateWebsite() {
        const data = {
            name1: document.getElementById('name1').value.trim(),
            name2: document.getElementById('name2').value.trim(),
            weddingDate: document.getElementById('weddingDate').value,
            ceremonyLocation: document.getElementById('ceremonyLocation').value.trim(),
            ceremonyAddress: document.getElementById('ceremonyAddress').value.trim(),
            ceremonyTime: document.getElementById('ceremonyTime').value,
            receptionLocation: document.getElementById('receptionLocation').value.trim(),
            receptionAddress: document.getElementById('receptionAddress').value.trim(),
            dressCode: document.getElementById('dressCode').value,
            hotelInfo: '',
            howMet: document.getElementById('howMet').value.trim(),
            proposal: document.getElementById('proposal').value.trim(),
            extraDetails: document.getElementById('extraDetails').value.trim(),
            tone: document.querySelector('input[name="tone"]:checked').value,
            theme: document.querySelector('input[name="theme"]:checked').value,
            customRegName: document.getElementById('customRegName').value.trim(),
            customRegUrl: document.getElementById('customRegUrl').value.trim(),
            selectedRegistries: Array.from(document.querySelectorAll('input[name="registry"]:checked')).map(cb => cb.value),
            photos: uploadedPhotos,
            heroPhoto: heroPhoto,
            schedule: scheduleItems,
            partyMembers: partyMembers,
            hotels: hotelItems,
        };

        if (!data.name1 || !data.name2) { alert('Please enter both names!'); return; }
        if (!data.howMet) { alert("Please tell us how you met ‚Äî that's the heart of your story!"); return; }

        document.getElementById('formSection').style.display = 'none';
        document.getElementById('loadingState').classList.add('visible');
        document.getElementById('resultSection').classList.remove('visible');

        let mi = 0;
        msgInterval = setInterval(() => {
            mi = (mi + 1) % loadingMessages.length;
            document.getElementById('loadingMessage').textContent = loadingMessages[mi];
        }, 3000);

        document.getElementById('step1indicator').classList.remove('active');
        document.getElementById('step1indicator').classList.add('done');
        document.getElementById('step2indicator').classList.add('active');

        const toneGuide = {
            romantic: 'Warm, poetic, deeply heartfelt. Use evocative language and paint a picture of their love.',
            humorous: 'Funny, lighthearted, witty. Include gentle humor. Make guests laugh while still feeling the love.',
            modern: 'Clean, direct, confident. No flowery language. Genuine and concise.',
            whimsical: 'Dreamy, fairytale-inspired, full of imagery and metaphor.',
            classic: 'Timeless, elegant, graceful. Like a story in a beautifully printed keepsake.'
        };

        // Build party blurb instructions
        const partyWithNotes = data.partyMembers.filter(p => p.name && p.role);
        const partyInstruction = partyWithNotes.length > 0 ? `

Also write a short 2-3 sentence blurb for each wedding party member below. Match the tone specified for each person. After the story HTML, output the blurbs in this exact format:
PARTY_BLURBS_START
[{"name":"...","blurb":"..."}]
PARTY_BLURBS_END

Wedding party:
${partyWithNotes.map(p => `- ${p.name} (${p.role}${p.relation ? ', ' + p.relation : ''}): Tone: ${p.tone || 'Sweet'}. About them: ${p.note || 'No info provided'}`).join('\n')}` : '';

        const prompt = `Write the "Our Story" section for ${data.name1} and ${data.name2}'s wedding website.

How they met: ${data.howMet}
The proposal: ${data.proposal || 'Not provided'}
Extra details: ${data.extraDetails || 'None'}

Tone: ${toneGuide[data.tone]}

Write 2-3 paragraphs as HTML <p> tags. Then add one memorable pull quote wrapped in: <div class="story-pull" style="font-style:italic;text-align:center;padding:28px 0;border-top:1px solid currentColor;border-bottom:1px solid currentColor;margin:32px 0;opacity:0.8;font-size:1.15rem;line-height:1.5;font-family:Georgia,serif;">quote here</div>${partyInstruction}

Output the story HTML first. Nothing else unless party blurbs were requested.`;

        try {
            const res = await fetch('/.netlify/functions/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ messages: [{ role: 'user', content: prompt }] })
            });
            const result = await res.json();
            const rawText = result.content?.[0]?.text || '<p>A beautiful love story, written in the stars.</p>';
            let storyCopy = rawText;
            let partyBlurbs = {};
            if (rawText.includes('PARTY_BLURBS_START')) {
                const parts = rawText.split('PARTY_BLURBS_START');
                storyCopy = parts[0].trim();
                try {
                    const jsonPart = parts[1].split('PARTY_BLURBS_END')[0].trim();
                    const blurbArr = JSON.parse(jsonPart);
                    blurbArr.forEach(b => { partyBlurbs[b.name] = b.blurb; });
                } catch(e) { console.warn('Could not parse party blurbs', e); }
            }
            data.partyBlurbs = partyBlurbs;

            clearInterval(msgInterval);
            document.getElementById('step2indicator').classList.remove('active');
            document.getElementById('step2indicator').classList.add('done');
            document.getElementById('step3indicator').classList.add('active');

            generatedHTML = buildWebsiteHTML(data, storyCopy);
            generatedData = data;
            generatedStoryCopy = storyCopy;

            // Populate story editor with plain text version
            const storyEditor = document.getElementById('storyEditor');
            if (storyEditor) {
                storyEditor.innerHTML = storyCopy;
            }

            // Set active theme button
            ['blush','navy','sage','ivory','dustyrose','lavender'].forEach(th => {
                const btn = document.getElementById('themeBtn_' + th);
                if (btn) {
                    btn.style.background = th === data.theme ? 'var(--blush)' : 'white';
                    btn.style.borderColor = th === data.theme ? 'var(--blush)' : 'var(--border)';
                    btn.style.color = th === data.theme ? 'white' : 'var(--text)';
                }
            });

            const iframe = document.getElementById('previewFrame');
            iframe.srcdoc = generatedHTML;
            document.getElementById('previewUrl').textContent = `${data.name1.toLowerCase()}-${data.name2.toLowerCase()}.netlify.app ‚Äî preview`;

            document.getElementById('loadingState').classList.remove('visible');
            document.getElementById('resultSection').classList.add('visible');
            setTimeout(() => document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);

        } catch(err) {
            clearInterval(msgInterval);
            alert('Something went wrong. Please try again!');
            document.getElementById('formSection').style.display = 'block';
            document.getElementById('loadingState').classList.remove('visible');
            console.error(err);
        }
    }

    function switchTheme(newTheme) {
        if (!generatedData) return;
        generatedData.theme = newTheme;
        const html = buildWebsiteHTML(generatedData, generatedStoryCopy);
        generatedHTML = html;
        const iframe = document.getElementById('previewFrame');
        iframe.srcdoc = html;
        // Update button styles
        ['blush','navy','sage','ivory','dustyrose','lavender'].forEach(th => {
            const btn = document.getElementById('themeBtn_' + th);
            if (btn) {
                btn.style.background = th === newTheme ? 'var(--blush)' : 'white';
                btn.style.borderColor = th === newTheme ? 'var(--blush)' : 'var(--border)';
                btn.style.color = th === newTheme ? 'white' : 'var(--text)';
            }
        });
    }

    function applyStoryEdit() {
        if (!generatedData) return;
        const editor = document.getElementById('storyEditor');
        generatedStoryCopy = editor.innerHTML;
        const html = buildWebsiteHTML(generatedData, generatedStoryCopy);
        generatedHTML = html;
        document.getElementById('previewFrame').srcdoc = html;
    }

    function saveProgress() {
        if (!generatedData) return;
        const save = {
            data: generatedData,
            story: generatedStoryCopy,
            html: generatedHTML,
            savedAt: new Date().toLocaleString()
        };
        const blob = new Blob([JSON.stringify(save)], { type: 'application/json' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'wedding-website-progress.json';
        a.click();
        const btn = event.target;
        const orig = btn.innerHTML;
        btn.textContent = 'Saved!';
        setTimeout(() => btn.innerHTML = orig, 2000);
    }

    function downloadWebsite() {
        if (!generatedHTML) return;
        const n1 = document.getElementById('name1').value.trim().toLowerCase().replace(/\s+/g,'-') || 'partner1';
        const n2 = document.getElementById('name2').value.trim().toLowerCase().replace(/\s+/g,'-') || 'partner2';
        const blob = new Blob([generatedHTML], { type: 'text/html;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `${n1}-and-${n2}-wedding-website.html`;
        link.click();
    }

    function copyWebsite() {
        if (!generatedHTML) return;
        navigator.clipboard.writeText(generatedHTML).then(() => {
            const btn = document.querySelector('.btn-sage');
            const orig = btn.innerHTML;
            btn.textContent = 'Copied!';
            setTimeout(() => btn.innerHTML = orig, 2000);
        });
    }

    function loadProgress(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const save = JSON.parse(e.target.result);
                const d = save.data;
                // Restore form fields
                if (d.name1) document.getElementById('name1').value = d.name1;
                if (d.name2) document.getElementById('name2').value = d.name2;
                if (d.weddingDate) document.getElementById('weddingDate').value = d.weddingDate;
                if (d.ceremonyLocation) document.getElementById('ceremonyLocation').value = d.ceremonyLocation;
                if (d.ceremonyAddress) document.getElementById('ceremonyAddress').value = d.ceremonyAddress;
                if (d.ceremonyTime) document.getElementById('ceremonyTime').value = d.ceremonyTime;
                if (d.receptionLocation) document.getElementById('receptionLocation').value = d.receptionLocation;
                if (d.receptionAddress) document.getElementById('receptionAddress').value = d.receptionAddress;
                if (d.dressCode) document.getElementById('dressCode').value = d.dressCode;
                if (d.howMet) document.getElementById('howMet').value = d.howMet;
                if (d.proposal) document.getElementById('proposal').value = d.proposal;
                if (d.extraDetails) document.getElementById('extraDetails').value = d.extraDetails;
                // Restore theme & tone
                if (d.theme) { const t = document.getElementById('theme-' + d.theme); if (t) t.checked = true; }
                if (d.tone) { const t = document.querySelector('input[name="tone"][value="' + d.tone + '"]'); if (t) t.checked = true; }
                // Restore schedule, party, hotels
                if (d.schedule) { scheduleItems = d.schedule; renderSchedule(); }
                if (d.partyMembers) { partyMembers = d.partyMembers; renderParty(); }
                if (d.hotels) { hotelItems = d.hotels; renderHotels(); }
                // Restore photos
                if (d.photos) { uploadedPhotos = d.photos; renderPhotoThumbs(); }
                if (d.heroPhoto) { heroPhoto = d.heroPhoto; document.getElementById('heroPhotoPreview').innerHTML = '<img src="' + d.heroPhoto + '" style="width:100%;height:100%;object-fit:cover;">'; document.getElementById('heroRemoveBtn').style.display = 'block'; }
                // Restore registry
                if (d.selectedRegistries) {
                    d.selectedRegistries.forEach(v => {
                        const cb = document.querySelector('input[name="registry"][value="' + v + '"]');
                        if (cb) { cb.checked = true; updateRegStyle(v, true); }
                    });
                }
                // If we have saved HTML, show the result
                if (save.html) {
                    generatedHTML = save.html;
                    generatedData = d;
                    generatedStoryCopy = save.story;
                    document.getElementById('storyEditor').innerHTML = save.story;
                    document.getElementById('previewFrame').srcdoc = save.html;
                    document.getElementById('previewUrl').textContent = d.name1.toLowerCase() + '-' + d.name2.toLowerCase() + '.netlify.app ‚Äî preview';
                    document.getElementById('formSection').style.display = 'none';
                    document.getElementById('resultSection').classList.add('visible');
                    ['blush','navy','sage','ivory','dustyrose','lavender'].forEach(th => {
                        const btn = document.getElementById('themeBtn_' + th);
                        if (btn) { btn.style.background = th === d.theme ? 'var(--blush)' : 'white'; btn.style.borderColor = th === d.theme ? 'var(--blush)' : 'var(--border)'; btn.style.color = th === d.theme ? 'white' : 'var(--text)'; }
                    });
                    document.getElementById('step1indicator').classList.add('done');
                    document.getElementById('step2indicator').classList.add('done');
                    document.getElementById('step3indicator').classList.add('active');
                    setTimeout(() => document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' }), 100);
                    alert('Progress loaded! Your saved website is ready. (' + save.savedAt + ')');
                } else {
                    alert('Form data loaded! Review your details and click Generate.');
                }
            } catch(err) {
                alert('Could not load progress file. Please make sure it\'s the correct file.');
            }
        };
        reader.readAsText(file);
    }

    function resetForm() {
        generatedHTML = '';
        uploadedPhotos = [];
        scheduleItems = [{ time: '', event: '', note: '' }];
        partyMembers = [];
        hotelItems = [];
        renderSchedule();
        renderParty();
        renderHotels();
        renderPhotoThumbs();
        document.getElementById('formSection').style.display = 'block';
        document.getElementById('resultSection').classList.remove('visible');
        document.querySelectorAll('.step').forEach(s => s.classList.remove('active','done'));
        document.getElementById('step1indicator').classList.add('active');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
</script>
</body>
</html>
